<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Chapter 13: Simple Web Applications &mdash; Jython Book v1.0 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '#',
        VERSION:     '1.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Jython Book v1.0 documentation" href="index.html" />
    <link rel="next" title="Chapter 14: Web Applications With Django" href="JythonDjango.html" />
    <link rel="prev" title="Chapter 12: Databases and Jython: Object Relational Mapping and Using JDBC" href="DatabasesAndJython.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="JythonDjango.html" title="Chapter 14: Web Applications With Django"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="DatabasesAndJython.html" title="Chapter 12: Databases and Jython: Object Relational Mapping and Using JDBC"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Jython Book v1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="chapter-13-simple-web-applications">
<h1>Chapter 13: Simple Web Applications<a class="headerlink" href="#chapter-13-simple-web-applications" title="Permalink to this headline">¶</a></h1>
<p>One of the major benefits of using Jython is the ability to make
use of Java platform capabilities programming in the Python
programming language instead of Java. In the Java world today, the
most widely used web development technique is the Java servlet. Now
in JavaEE, there are techniques and frameworks used so that we can
essentially code HTML or other markup languages as opposed to
writing pure Java servlets. However, sometimes writing a pure Java
servlet still has its advantages. We can use Jython to write
servlets and this adds many more advantages above and beyond what
Java has to offer because now we can make use of Python language
features as well. Similarly, we can code web start applications
using Jython instead of pure Java to make our lives easier. Coding
these applications in pure Java has proven sometimes to be a
difficult and sometimes grueling task. We can use some of the
techniques available in Jython to make our lives easier. We can
even code WSGI applications with Jython making use of the <em>modjy</em>
integration in the Jython project.</p>
<p>In this chapter, we will cover three techniques for coding simple
web applications using Jython: servlets, web start, and WSGI. We’ll
get into details on using each of these different techniques here,
but we will discuss deployment of such solutions in Chapter 17.</p>
<div class="section" id="servlets">
<h2>Servlets<a class="headerlink" href="#servlets" title="Permalink to this headline">¶</a></h2>
<p>Servlets are a Java platform technology for building web-based
applications. They are a platform- and server-independent
technology for serving content to the web. If you are unfamiliar
with Java servlets, it would be worthwhile to learn more about
them. An excellent resource is wikipedia
(<a class="reference external" href="http://en.wikipedia.org/wiki/Java_Servlet">http://en.wikipedia.org/wiki/Java_Servlet</a>); however, there are a
number of other great places to find out more about Java servlets.
Writing servlets in Jython is a very productive and easy way to
make use of Jython within a web application. Java servlets are
rarely written using straight Java anymore. Most Java developers
make use of Java Server Pages (JSP), Java Server Faces (JSF), or
some other framework so that they can use a markup language to work
with web content as opposed to only working with Java code.
However, in some cases it is still quite useful to use a pure Java
servlet. For these cases we can make our lives easier by using
Jython instead. There are also great use-cases for JSP; similarly,
we can use Jython for implementing the logic in our JSP code. The
latter technique allows us to apply a model-view-controller (MVC)
paradigm to our programming model, where we separate our front-end
markup from any implementation logic. Either technique is rather
easy to implement, and you can even add this functionality to any
existing Java web application without any trouble.</p>
<p>Another feature offered to us by Jython servlet usage is dynamic
testing. Because Jython compiles at runtime, we can make code
changes on the fly without recompiling and redeploying our web
application. This can make it very easy to test web applications,
because usually the most painful part of web application
development is the wait time between deployment to the servlet
container and testing.</p>
<div class="section" id="configuring-your-web-application-for-jython-servlets">
<h3>Configuring Your Web Application for Jython Servlets<a class="headerlink" href="#configuring-your-web-application-for-jython-servlets" title="Permalink to this headline">¶</a></h3>
<p>Very little needs to be done in any web application to make it
compatible for use with Jython servlets. Jython contains a built-in
class named <em>PyServlet</em> that facilitates the creation of Java
servlets using Jython source files. We can make use of PyServlet
quite easily in our application by adding the necessary XML
configuration into the application’s web.xml descriptor such that
the <em>PyServlet</em> class gets loaded at runtime and any file that
contains the <em>.py</em> suffix will be passed to it. Once this
configuration has been added to a web application, and <em>jython.jar</em>
has been added to the CLASSPATH then the web application is ready
to use Jython servlets. See Listing 13-1.</p>
<p><em>Listing 13-1. Making a Web Application Compatible with Jython</em></p>
<div class="highlight-python"><pre>&lt;servlet&gt;
    &lt;servlet-name&gt;PyServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.python.util.PyServlet&lt;/servlet-class&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;PyServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;*.py&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</pre>
</div>
<p>Any servlet that is going to be used by a Java servlet container
also needs to be added to the <em>web.xml</em> file as well, since this
allows for the correct mapping of the servlet via the URL. For the
purposes of this book, we will code a servlet named
<em>NewJythonServlet</em> in the next section, so the following XML
configuration will need to be added to the web.xml file. See
Listing 13-2.</p>
<p><em>Listing 13-2. Coding a Jython Servlet</em></p>
<div class="highlight-python"><pre>&lt;servlet&gt;
    &lt;servlet-name&gt;NewJythonServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;NewJythonServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;NewJythonServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/NewJythonServlet&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</pre>
</div>
</div>
<div class="section" id="writing-a-simple-servlet">
<h3>Writing a Simple Servlet<a class="headerlink" href="#writing-a-simple-servlet" title="Permalink to this headline">¶</a></h3>
<p>In order to write a servlet, we must have the
<em>javax.servlet.http.HttpServlet</em> abstract Java class within our
CLASSPATH so that it can be extended by our Jython servlet to help
facilitate the code. This abstract class, along with the other
servlet implementation classes, is part of the <em>servlet-api.jar</em>
file. According to the abstract class, there are two methods that
we should override in any Java servlet, those being <em>doGet</em> and
<em>doPost</em>. The former performs the HTTP GET operation while the
latter performs the HTTP POST operation for a servlet. Other
commonly overridden methods include <em>doPut</em>, <em>doDelete</em>, and
<em>getServletInfo</em>. The first performs the HTTP PUT operation, the
second performs the HTTP DELETE operation, and the last provides a
description for a servlet. In the following example, and in most
use-cases, only the <em>doGet</em> and <em>doPost</em> are used.</p>
<p>Let’s first show the code for an extremely simple Java servlet.
This servlet contains no functionality other than printing its name
along with its location in the web application to the screen.
Following that code we will take a look at the same servlet coded
in Jython for comparison (Listing 13-3).</p>
<p><em>Listing 13-3. NewJavaServlet.java</em></p>
<div class="highlight-python"><pre>import java.io.IOException;
import java.io.PrintWriter;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class NewJavaServlet extends HttpServlet {
    protected void processRequest(HttpServletRequest request, HttpServletResponse response)
    throws ServletException, IOException {
        response.setContentType("text/html;charset=UTF-8");
        PrintWriter out = response.getWriter();
        try {
            out.println("&lt;html&gt;");
            out.println("&lt;head&gt;");
            out.println("&lt;title&gt;Servlet NewJavaServlet Test&lt;/title&gt;");
            out.println("&lt;/head&gt;");
            out.println("&lt;body&gt;");
            out.println("&lt;h1&gt;Servlet NewJavaServlet at " +
            request.getContextPath () + "&lt;/h1&gt;");
            out.println("&lt;/body&gt;");
            out.println("&lt;/html&gt;");
        } finally {
            out.close();
        }
    }

    @Override
    protected void doGet(HttpServletRequest request,
    HttpServletResponse response)
    throws ServletException, IOException {
        processRequest(request, response);
    }

    @Override
    protected void doPost(HttpServletRequest request,
    HttpServletResponse response)
    throws ServletException, IOException {
        processRequest(request, response);
    }

    @Override
    public String getServletInfo() {
        return "Short description";
    }
}</pre>
</div>
<p>All commenting has been removed from the code in an attempt to make
the code a bit shorter. Now, Listing 13-4 is the equivalent servlet
code written in Jython.</p>
<p><em>Listing 13-4.</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">javax.servlet.http</span> <span class="kn">import</span> <span class="n">HttpServlet</span>

<span class="k">class</span> <span class="nc">NewJythonServlet</span> <span class="p">(</span><span class="n">HttpServlet</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">doGet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="n">response</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doPost</span> <span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">doPost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="n">response</span><span class="p">):</span>
        <span class="n">toClient</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">getWriter</span><span class="p">()</span>
        <span class="n">response</span><span class="o">.</span><span class="n">setContentType</span> <span class="p">(</span><span class="s">&quot;text/html&quot;</span><span class="p">)</span>
        <span class="n">toClient</span><span class="o">.</span><span class="n">println</span> <span class="p">(</span><span class="s">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Jython Servlet Test&lt;/title&gt;&quot;</span>
        <span class="o">+</span>
        <span class="s">&quot;&lt;body&gt;&lt;h1&gt;Servlet Jython Servlet at&quot;</span> <span class="o">+</span>
        <span class="n">request</span><span class="o">.</span><span class="n">getContextPath</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getServletInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;Short Description&quot;</span>
</pre></div>
</div>
<p>Not only is the concise code an attractive feature, but also the
easy development lifecycle for working with dynamic servlets. As
stated previously, there is no need to redeploy each time you make
a change because of the compile at runtime that Jython offers.
Simply change the Jython servlet, save, and reload the webpage to
see the update. If you begin to think about the possibilities
you’ll realize that the code above is just a basic example, you can
do anything in a Jython servlet that you can with Java and even
most of what can be done using the Python language as well.</p>
<p>To summarize the use of Jython servlets, you simply include
<em>jython.jar</em> and <em>servlet-api.jar</em> in your CLASSPATH. Add necessary
XML to the web.xml, and then finally code the servlet by extending
the javax.servlet.http.HttpServlet abstract class.</p>
</div>
<div class="section" id="using-jsp-with-jython">
<h3>Using JSP with Jython<a class="headerlink" href="#using-jsp-with-jython" title="Permalink to this headline">¶</a></h3>
<p>Harnessing Jython servlets allows for a more productive development
lifecycle, but in certain situations Jython code may not be the
most convenient way to deal with front-facing web code. Sometimes
using a markup language such as HTML works better for developing
sophisticated front-ends. For instance, it is easy enough to
include JavaScript code within a Jython servlet. However, all of
the JavaScript code would be written within the context of a
String. Not only does this eliminate the usefulness of an IDE for
situations such as semantic code coloring and auto completion, but
it also makes code harder to read and understand. Cleanly
separating such code from Jython or Java makes code more clear to
read, and easier to maintain in the long run. One possible solution
would be to choose from one of the Python template languages such
as Django, but using Java Server Pages (JSP) technology can also be
a nice solution.</p>
<p>Using a JSP allows one to integrate Java code into HTML markup in
order to generate dynamic page content. We are not fans of JSP.
There, we said it: JSP can make code a living nightmare if the
technology is not used correctly. Although JSP can make it very
easy to mix JavaScript, HTML, and Java into one file, it can make
maintenance very difficult. Mixing Java code with HTML or
JavaScript is a bad idea. The same would also be true for mixing
Jython and HTML or JavaScript.</p>
<p>The Model-View-Controller (MVC) paradigm allows for clean
separation between logic code, such as Java or Jython, and markup
code such as HTML. JavaScript is always gets grouped into the same
arena as HTML because it is a client-side scripting language. In
other words, JavaScript code should also be separated from the
logic code. In thinking about MVC, the controller code would be the
markup and JavaScript code used to capture data from the end-user.
Model code would be the business logic that manipulates the data.
Model code is contained within our Jython or Java. The view would
be the markup and JavaScript displaying the result.</p>
<p>Clean separation using MVC can be achieved successfully by
combining JSP with Jython servlets. In this section we will take a
look at a simple example of how to do so. As with many of the other
examples in this text it will only brush upon the surface of great
features that are available. Once you learn how to make use of JSP
and Jython servlets you can explore further into the technology.</p>
<div class="section" id="configuring-for-jsp">
<h4>Configuring for JSP<a class="headerlink" href="#configuring-for-jsp" title="Permalink to this headline">¶</a></h4>
<p>There is no real configuration above and beyond that of configuring
a web application to make use of Jython servlets. Add the necessary
XML to the web.xml deployment descriptor, include the correct JARs
in your application, and begin coding. What is important to note is
that the <em>.py</em> files that will be used for the Jython servlets must
reside within your CLASSPATH. It is common for the Jython servlets
to reside in the same directory as the JSP web pages themselves.
This can make things easier, but it can also be frowned upon
because this concept does not make use of packages for organizing
code. For simplicity sake, we will place the servlet code into the
same directory as the JSP, but you can do it differently.</p>
</div>
<div class="section" id="coding-the-controller-view">
<h4>Coding the Controller/View<a class="headerlink" href="#coding-the-controller-view" title="Permalink to this headline">¶</a></h4>
<p>The view portion of the application will be coded using markup and
JavaScript code. Obviously, this technique utilizes JSP to contain
the markup, and the JavaScript can either be embedded directly into
the JSP or reside in separate <em>.js</em> files as needed. The latter is
the preferred method in order to make things clean, but many web
applications embed small amounts of JavaScript within the pages
themselves.</p>
<p>The JSP in this example is rather simple, there is no JavaScript in
the example and it only contains a couple of input text areas. This
JSP will include two forms because we will have two separate submit
buttons on the page. Each of these forms will redirect to a
different Jython servlet, which will do something with the data
that has been supplied within the input text. In our example, the
first form contains a small textbox in which the user can type any
text that will be redisplayed on the page once the corresponding
submit button has been pressed. Very cool, eh? Not really, but it
is of good value for learning the correlation between JSP and the
servlet implementation. The second form contains two text boxes in
which the user will place numbers; hitting the submit button in
this form will cause the numbers to be passed to another servlet
that will calculate and return the sum of the two numbers. Listing
13-5 is the code for this simple JSP.</p>
<p><em>Listing 13-5. JSP Code for a Simple Controller/Viewer Application</em></p>
<p><em>testJSP.jsp</em></p>
<div class="highlight-python"><pre>&lt;%@page contentType="text/html" pageEncoding="UTF-8"%&gt;
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
        &lt;title&gt;Jython JSP Test&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;form method="GET" action="add_to_page.py"&gt;
            &lt;input type="text" name="p"&gt;
            &lt;input type="submit"&gt;
        &lt;/form&gt;
        &lt;br/&gt;
        &lt;p&gt;${page_text}&lt;/p&gt;
        &lt;br/&gt;
        &lt;form method="GET" action="add_numbers.py"&gt;
            &lt;input type="text" name="x"&gt;
            +
            &lt;input type="text" name="y"&gt;
            =
            ${sum}
            &lt;br/&gt;
            &lt;input type="submit" title="Add Numbers"&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<p>In this JSP example, you can see that the first form redirects to a
Jython servlet named
<em>add_to_page.py, which plays the role of the controller</em>. In this
case, the text that is contained within the input textbox named <em>p</em>
will be passed into the servlet, and redisplayed in on the page.
The text to be redisplayed will be stored in an attribute named
<em>page_text</em>, and you can see that it is referenced within the JSP
page using the ${} notation. Listing 13-6 is the code for
<em>add_to_page.py</em>.</p>
<p><em>Listing 13-6. A Simple Jython Controller Servlet</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#######################################################################</span>
<span class="c"># add_to_page.py</span>
<span class="c">#</span>
<span class="c"># Simple servlet that takes some text from a web page and redisplays</span>
<span class="c"># it.</span>
<span class="c">#######################################################################</span>
<span class="kn">import</span> <span class="nn">java</span><span class="o">,</span> <span class="nn">javax</span><span class="o">,</span> <span class="nn">sys</span>

<span class="k">class</span> <span class="nc">add_to_page</span><span class="p">(</span><span class="n">javax</span><span class="o">.</span><span class="n">servlet</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">HttpServlet</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">doGet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doPost</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">doPost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">addtext</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">getParameter</span><span class="p">(</span><span class="s">&quot;p&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">addtext</span><span class="p">:</span>
            <span class="n">addtext</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">request</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&quot;page_text&quot;</span><span class="p">,</span> <span class="n">addtext</span><span class="p">)</span>
        <span class="n">dispatcher</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">getRequestDispatcher</span><span class="p">(</span><span class="s">&quot;testJython.jsp&quot;</span><span class="p">)</span>
        <span class="n">dispatcher</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
<p>Quick and simple, the servlet takes the request and obtains value
contained within the parameter <em>p</em>. It then assigns that value to a
variable named <em>addtext</em>. This variable is then assigned to an
attribute in the request named <em>page_text</em> and forwarded back to
the <em>testJython.jsp</em> page. The code could just as easily have
forwarded to a different JSP, which is how we’d go about creating a
more in-depth application.</p>
<p>The second form in our JSP takes two values and returns the
resulting sum to the page. If someone were to enter text instead of
numerical values into the text boxes then an error message would be
displayed in place of the sum. While very simplistic, this servlet
demonstrates that any business logic can be coded in the servlet,
including database calls, and so on. See Listing 13-7.</p>
<p><em>Listing 13-7. Jython Servlet Business Logic</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#######################################################################</span>
<span class="c"># add_numbers.py</span>
<span class="c">#</span>
<span class="c"># Calculates the sum for two numbers and returns it.</span>
<span class="c">#######################################################################</span>
<span class="kn">import</span> <span class="nn">javax</span>

<span class="k">class</span> <span class="nc">add_numbers</span><span class="p">(</span><span class="n">javax</span><span class="o">.</span><span class="n">servlet</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">HttpServlet</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">doGet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doPost</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">doPost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">getParameter</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">getParameter</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">y</span><span class="p">:</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="s">&quot;&lt;font color=&#39;red&#39;&gt;You must place numbers in each value box&lt;/font&gt;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">sum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">sum</span> <span class="o">=</span> <span class="s">&quot;&lt;font color=&#39;red&#39;&gt;You must place numbers only in each value box&lt;/font&gt;&quot;</span>
        <span class="n">request</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">&quot;sum&quot;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">)</span>

        <span class="n">dispatcher</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">getRequestDispatcher</span><span class="p">(</span><span class="s">&quot;testJython.jsp&quot;</span><span class="p">)</span>
        <span class="n">dispatcher</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
<p>If we add the JSP and the servlets to the web application we
created in the previous Jython Servlet section, then this example
should work out-of-the-box.</p>
<p>It is also possible to embed code into Java Server Pages by using
various template tags known as scriptlets to enclose the code. In
such cases, the JSP must contain Java code unless a special
framework such as the Bean Scripting Framework
(<a class="reference external" href="http://jakarta.apache.org/bsf/">http://jakarta.apache.org/bsf/</a>) is used along with JSP. For more
details on using Java Server Pages, please take a look at the Sun
Microsystems JSP documentation
(<a class="reference external" href="http://java.sun.com/products/jsp/docs.html">http://java.sun.com/products/jsp/docs.html</a>) or pick up a book such
as
<em>Beginning JSP, JSF and Tomcat Web Development: From Novice to Professional</em> from
Apress.</p>
</div>
</div>
</div>
<div class="section" id="applets-and-java-web-start">
<h2>Applets and Java Web Start<a class="headerlink" href="#applets-and-java-web-start" title="Permalink to this headline">¶</a></h2>
<p>At the time of this writing, applets in Jython 2.5.0 are not yet an
available option. This is because applets must be statically
compiled and available for embedding within a webpage using the
<em>&lt;applet&gt;</em> or <em>&lt;object&gt;</em> tag. The static compiler known as
<a href="#id1"><span class="problematic" id="id2">*</span></a>jythonc***has been removed in Jython 2.5.0 in order to make way
for better techniques. Jythonc was good for performing certain
tasks, such as static compilation of Jython applets, but it created
a disconnect in the development lifecycle as it was a separate
compilation step that should not be necessary in order to perform
simple tasks such as Jython and Java integration. In a future
release of Jython, namely 2.5.1 or another release in the near
future, a better way to perform static compilation for applets will
be included.</p>
<p>For now, in order to develop Jython applets you will need to use a
previous distribution including <em>jythonc</em> and then associate them
to the webpage with the <em>&lt;applet&gt;</em> or <em>&lt;object&gt;</em> tag. In Jython,
applets are coded in much the same fashion as a standard Java
applet. However, the resulting lines of code are significantly
smaller in Jython because of its sophisticated syntax. GUI
development in general with Jython is a big productivity boost
compared to developing a Java Swing application for much the same
reason. This is why coding applets in Jython is a viable solution
and one that should not be overlooked.</p>
<p>Another option for distributing GUI-based applications on the web
is to make use of the Java Web Start technology. The only
disadvantage of creating a web start application is that it cannot
be embedded directly into any web page. A web start application
downloads content to the client’s desktop and then runs on the
client’s local JVM. Development of a Java Web Start application is
no different than development of a standalone desktop application.
The user interface can be coded using Jython and the Java Swing
API, much like the coding for an applet user interface. Once you’re
ready to deploy a web start application then you need to create a
Java Network Launching Protocol (JNLP) file that is used for
deployment and bundle it with the application. After that has been
done, you need to copy the bundle to a web server and create a web
page that can be used to launch the application.</p>
<p>In this section we will develop a small web start application to
demonstrate how it can be done using the object factory design
pattern and also using pure Jython along with the standalone Jython
JAR file for distribution. Note that there are probably other ways
to achieve the same result and that these are just a couple of
possible implementations for such an application.</p>
<div class="section" id="coding-a-simple-gui-based-web-application">
<h3>Coding a Simple GUI-Based Web Application<a class="headerlink" href="#coding-a-simple-gui-based-web-application" title="Permalink to this headline">¶</a></h3>
<p>The web start application that we will develop in this
demonstration is very simple, but they can be as advanced as you’d
like in the end. The purpose of this section is not to show you how
to develop a web-based GUI application, but rather, the process of
developing such an application. You can actually take any of the
Swing-based applications that were discussed in the GUI chapter and
deploy them using web start technology quite easily. As stated in
the previous section, there are many different ways to deploy a
Jython web start application. We prefer to make use of the object
factory design pattern to create simple Jython Swing applications.
However, it can also be done using all .py files and then
distributed using the Jython stand-alone JAR file. We will discuss
each of those techniques in this section. We find that if you are
mixing Java and Jython code then the object factory pattern works
best. The JAR method may work best for you if developing a strictly
Jython application.</p>
<div class="section" id="object-factory-application-design">
<h4>Object Factory Application Design<a class="headerlink" href="#object-factory-application-design" title="Permalink to this headline">¶</a></h4>
<p>The application we’ll be developing in this section is a simple GUI
that takes a line of text and redisplays it in JTextArea. We used
Netbeans 6.7 to develop the application, so some of this section
may reference particular features that are available in that IDE.
To get started with creating an object factory web start
application, we first need to create a project. We created a new
Java application in Netbeans named <em>JythonSwingApp</em> and then added
<em>jython.jar</em> and <em>plyjy.jar</em> to the classpath.</p>
<p>First, create the <em>Main.java</em> class which will really be the driver
for the application. The goal for Main.java is to use the Jython
object factory pattern to coerce a Jython-based Swing application
into Java. This class will be the starting point for the
application and then the Jython code will perform all of the work
under the covers. Using this pattern, we also need a Java interface
that can be implemented via the Jython code, so this example also
uses a very simple interface that defines a <em>start()</em> method which
will be used to make our GUI visible. Lastly, the Jython class
named below is the code for our <em>Main.java</em> driver and the Java
interface. The directory structure of this application is as shown
in Listing 13-8.</p>
<p><em>Listing 13-8. Object Factory Application Code</em></p>
<blockquote>
<dl class="docutils">
<dt><strong>JythonSwingApp</strong></dt>
<dd><p class="first"><strong>JythonSimpleSwing.py</strong></p>
<dl class="last docutils">
<dt><strong>jythonswingapp</strong></dt>
<dd><p class="first">Main.java</p>
<p><strong>jythonswingapp.interfaces</strong></p>
<p class="last">JySwingType.java</p>
</dd>
</dl>
</dd>
</dl>
</blockquote>
<p><em>Main.java</em></p>
<div class="highlight-python"><pre>package jythonswingapp;

import jythonswingapp.interfaces.JySwingType;
import org.plyjy.factory.JythonObjectFactory;

public class Main {
    JythonObjectFactory factory;

    public static void invokeJython(){
        JySwingType jySwing = (JySwingType) JythonObjectFactory
        .createObject(JySwingType.class, "JythonSimpleSwing");
        jySwing.start();
    }

    public static void main(String[] args) {
        invokeJython();
    }
}</pre>
</div>
<p>As you can see, <em>Main.java</em> doesn’t do much else except coercing
the Jython module and invoking the <em>start()</em> method. In Listing
13-9, you will see the <em>JySwingType.java</em> interface along with the
implementation class that is obviously coded in Jython.</p>
<p><em>Listing 13-9. JySwingType.java Interface and Implementation</em></p>
<p><em>JySwingType.java</em></p>
<div class="highlight-python"><pre>package jythonswingapp.interfaces;

public interface JySwingType {
    public void start();
}</pre>
</div>
<p><em>JythonSimpleSwing.py</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">javax.swing</span> <span class="kn">as</span> <span class="nn">swing</span>
<span class="kn">import</span> <span class="nn">java.awt</span> <span class="kn">as</span> <span class="nn">awt</span>
<span class="kn">from</span> <span class="nn">jythonswingapp.interfaces</span> <span class="kn">import</span> <span class="n">JySwingType</span>
<span class="kn">import</span> <span class="nn">add_player</span> <span class="kn">as</span> <span class="nn">add_player</span>
<span class="kn">import</span> <span class="nn">Player</span> <span class="kn">as</span> <span class="nn">Player</span>

<span class="k">class</span> <span class="nc">JythonSimpleSwing</span><span class="p">(</span><span class="n">JySwingType</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">=</span><span class="n">swing</span><span class="o">.</span><span class="n">JFrame</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;My Frame&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mf">300</span><span class="p">,</span><span class="mf">300</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">defaultCloseOperation</span><span class="o">=</span><span class="n">swing</span><span class="o">.</span><span class="n">JFrame</span><span class="o">.</span><span class="n">EXIT_ON_CLOSE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">layout</span><span class="o">=</span><span class="n">awt</span><span class="o">.</span><span class="n">BorderLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel1</span><span class="o">=</span><span class="n">swing</span><span class="o">.</span><span class="n">JPanel</span><span class="p">(</span><span class="n">awt</span><span class="o">.</span><span class="n">BorderLayout</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel2</span><span class="o">=</span><span class="n">swing</span><span class="o">.</span><span class="n">JPanel</span><span class="p">(</span><span class="n">awt</span><span class="o">.</span><span class="n">GridLayout</span><span class="p">(</span><span class="mf">4</span><span class="p">,</span><span class="mf">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel2</span><span class="o">.</span><span class="n">preferredSize</span> <span class="o">=</span> <span class="n">awt</span><span class="o">.</span><span class="n">Dimension</span><span class="p">(</span><span class="mf">10</span><span class="p">,</span><span class="mf">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel3</span><span class="o">=</span><span class="n">swing</span><span class="o">.</span><span class="n">JPanel</span><span class="p">(</span><span class="n">awt</span><span class="o">.</span><span class="n">BorderLayout</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">=</span><span class="n">swing</span><span class="o">.</span><span class="n">JLabel</span><span class="p">(</span><span class="s">&quot;Text Rendering&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button1</span><span class="o">=</span><span class="n">swing</span><span class="o">.</span><span class="n">JButton</span><span class="p">(</span><span class="s">&quot;Print Text&quot;</span><span class="p">,</span> <span class="n">actionPerformed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">printMessage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button2</span><span class="o">=</span><span class="n">swing</span><span class="o">.</span><span class="n">JButton</span><span class="p">(</span><span class="s">&quot;Clear Text&quot;</span><span class="p">,</span> <span class="n">actionPerformed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">clearMessage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textField</span><span class="o">=</span><span class="n">swing</span><span class="o">.</span><span class="n">JTextField</span><span class="p">(</span><span class="mf">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputText</span><span class="o">=</span><span class="n">swing</span><span class="o">.</span><span class="n">JTextArea</span><span class="p">(</span><span class="mf">4</span><span class="p">,</span><span class="mf">15</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">panel1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">textField</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">button1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">button2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel3</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputText</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">contentPane</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel1</span><span class="p">,</span> <span class="n">awt</span><span class="o">.</span><span class="n">BorderLayout</span><span class="o">.</span><span class="n">PAGE_START</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">contentPane</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel2</span><span class="p">,</span> <span class="n">awt</span><span class="o">.</span><span class="n">BorderLayout</span><span class="o">.</span><span class="n">CENTER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">contentPane</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel3</span><span class="p">,</span> <span class="n">awt</span><span class="o">.</span><span class="n">BorderLayout</span><span class="o">.</span><span class="n">PAGE_END</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">visible</span><span class="o">=</span><span class="mf">1</span>

    <span class="k">def</span> <span class="nf">printMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;Print Text!&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textField</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputText</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clearMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputText</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
</pre></div>
</div>
<p>If you are using Netbeans, when you clean and build your project a
JAR file is automatically generated for you. However, you can
easily create a JAR file at the command-line or terminal by
ensuring that the <em>JythonSimpleSwing.py</em> module resides within your
classpath and using the <em>java -jar</em> option. Another nice feature of
using an IDE such as Netbeans is that you can make this into a
web-start application by going into the project properties and
checking a couple of boxes. Specifically, if you go into the
project properties and select <em>Application - Web Start</em> from the
left-hand menu, then check the <em>Enable Web Start</em> option then the
IDE will take care of generating the necessary files to make this
happen. Netbeans also has the option to self sign the JAR file
which is required to run most applications on another machine via
web start. Go ahead and try it out, just ensure that you clean and
build your project again after making the changes.</p>
<p>To manually create the necessary files for a web start application,
you’ll need to generate two additional files that will be placed
outside of the application JAR. Create the JAR for your project as
you would normally do, and then create a corresponding JNLP file
which is used to launch the application, and an HTML page that will
reference the JNLP. The HTML page obviously is where you’d open the
application if running it from the web. Listing 13-10 is some
example code for generating a JNLP as well as embedding in HTML.</p>
<p><em>Listing 13-10. JNLP Code for Web Start</em></p>
<p><em>launch.jnlp</em></p>
<div class="highlight-python"><pre>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;jnlp codebase="file:/path-to-jar/" href="launch.jnlp" spec="1.0+"&gt;
    &lt;information&gt;
        &lt;title&gt;JythonSwingApp&lt;/title&gt;
        &lt;vendor&gt;YourName&lt;/vendor&gt;
        &lt;homepage href=""/&gt;
        &lt;description&gt;JythonSwingApp&lt;/description&gt;
        &lt;description kind="short"&gt;JythonSwingApp&lt;/description&gt;
    &lt;/information&gt;
    &lt;security&gt;
        &lt;all-permissions/&gt;
    &lt;/security&gt;
    &lt;resources&gt;
        &lt;j2se version="1.5+"/&gt;
        &lt;jar eager="true" href="JythonSwingApp.jar" main="true"/&gt;
        &lt;jar href="lib/PlyJy.jar"/&gt;
        &lt;jar href="lib/jython.jar"/&gt;
    &lt;/resources&gt;
    &lt;application-desc main-class="jythonswingapp.Main"&gt;
    &lt;/application-desc&gt;
&lt;/jnlp&gt;</pre>
</div>
<p><em>launch.html</em></p>
<div class="highlight-python"><pre>&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Test page for launching the application via JNLP&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h3&gt;Test page for launching the application via JNLP&lt;/h3&gt;
        &lt;a href="launch.jnlp"&gt;Launch the application&lt;/a&gt;
        &lt;!-- Or use the following script element to launch with the
        Deployment Toolkit --&gt;
        &lt;!-- Open the deployJava.js script to view its documentation --&gt;
        &lt;!--
        &lt;script src="http://java.com/js/deployJava.js"&gt;&lt;/script&gt;
        &lt;script&gt;
        var url="http://[fill in your URL]/launch.jnlp"
        deployJava.createWebStartLaunchButton(url, "1.6")
        &lt;/script&gt;
        --&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<p>In the end, Java web start is a very good way to distribute Jython
applications via the web.</p>
</div>
</div>
<div class="section" id="distributing-via-standalone-jar">
<h3>Distributing via Standalone JAR<a class="headerlink" href="#distributing-via-standalone-jar" title="Permalink to this headline">¶</a></h3>
<p>It is possible to distribute a web start application using the
Jython standalone JAR option. To do so, you must have a copy of the
Jython standalone JAR file, explode it, and add your code into the
file, then JAR it back up to deploy. The only drawback to using
this method is that you may need to ensure files are in the correct
locations in order to make it work correctly, which can sometimes
be tedious.</p>
<p>In order to distribute your Jython applications via a JAR, first
download the Jython standalone distribution. Once you have this,
you can extract the files from the <em>jython.jar</em> using a tool to
expand the JAR such as Stuffit or 7zip. Once the JAR has been
exploded, you will need to add any of your <em>.py</em> scripts into the
<em>Lib</em> directory, and any Java classes into the root. For instance,
if you have a Java class named <em>org.jythonbook.Book</em>, you would
place it into the appropriate directory according to the package
structure. If you have any additional JAR files to include with
your application then you will need to make sure that they are in
your classpath. Once you’ve completed this setup, JAR your
manipulated standalone Jython JAR back up into a ZIP format using a
tool such as those noted before. You can then rename the ZIP to a
JAR. The application can now be run using the java “-jar” option
from the command line using an optional external <em>.py</em> file to
invoke your application.</p>
<div class="highlight-python"><pre>$ java -jar newStandaloneJar.jar {optional .py file}</pre>
</div>
<p>This is only one such technique used to make a JAR file for
containing your applications. There are other ways to perform such
techniques, but this seems to be the most straight forward and
easiest to do.</p>
</div>
</div>
<div class="section" id="wsgi-and-modjy">
<h2>WSGI and Modjy<a class="headerlink" href="#wsgi-and-modjy" title="Permalink to this headline">¶</a></h2>
<p>WSGI, also known as the <em>Web Server Gateway Interface</em>, is a
low-level API that provides communication between a web server and
a web application. Actually, WSGI is a lot more than that and you
can actually write complete web applications using WSGI. However,
WSGI is more of a standard interface to call python methods and
functions. Python PEP 333 specifies the proposed standard interface
between web servers and Python web applications or frameworks, to
promote web application portability across a variety of web
servers.</p>
<p>This section will show you how to utilize WSGI to create a very
simple “Hello Jython” application by utilizing <em>modjy</em>. Modjy is an
implementation of a WSGI compliant gateway/server for Jython, built
on Java/J2EE servlets. Taken from the modjy website
(<a class="reference external" href="http://opensource.xhaus.com/projects/modjy/wiki">http://opensource.xhaus.com/projects/modjy/wiki</a>), modjy is
characterized as follows:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Jython WSGI applications run inside a Java/J2EE container and incoming requests are handled by the servlet container. The container is configured to route requests to the modjy servlet. The modjy servlet then creates an embedded Jython interpreter inside the servlet container, and loads a configured Jython web application. For instance, a Django application can be loaded via modjy. The modjy servlet then delegates the requests to the configured WSGI application or framework. Lastly, the WSGI response is routed back to the client through the servlet container.</p>
</div>
<div class="section" id="running-a-modjy-application-in-glassfish">
<h3>Running a Modjy Application in Glassfish<a class="headerlink" href="#running-a-modjy-application-in-glassfish" title="Permalink to this headline">¶</a></h3>
<p>To run a modjy application in any Java servlet container, the first
step is to create a Java web application that will be packaged up
as a WAR file. You can create an application from scratch or use an
IDE such as Netbeans 6.7 to assist. Once you’ve created your web
application, ensure that <em>jython.jar</em> resides in the CLASSPATH as
modjy is now part of Jython as of 2.5.0. Lastly, you will need to
configure the modjy servlet within the application deployment
descriptor (web.xml). In this example, we took the modjy sample
application for Google App Engine and deployed it in my local
Glassfish environment.</p>
<p>To configure the application deployment descriptor with modjy, we
simply configure the modjy servlet, provide the necessary
parameters, and then provide a servlet mapping. In the
configuration file shown in Listing 13-11, note that the modjy
servlet class is <em>com.xhaus.modjy.ModjyServlet</em>. The first
parameter you will need to use with the servlet is named
<em>python.home</em>. Set the value of this parameter equal to your Jython
home. Next, set the parameter <em>python.cachedir.skip</em> equal to true.
The <em>app_filename</em> parameter provides the name of the application
callable. Other parameters will be set up the same for each modjy
application you configure. The last piece of the web.xml that needs
to be set up is the servlet mapping. In the example, we set up all
URLs to map to the modjy servlet.</p>
<p><em>Listing 13-11. Configuring the Modjy Servlet</em></p>
<p><em>web.xml</em></p>
<div class="highlight-python"><pre>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;!DOCTYPE web-app
PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
"http://java.sun.com/dtd/web-app_2_3.dtd"&gt;
&lt;web-app&gt;
    &lt;display-name&gt;modjy demo application&lt;/display-name&gt;
    &lt;description&gt;
        modjy WSGI demo application
    &lt;/description&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;modjy&lt;/servlet-name&gt;
        &lt;servlet-class&gt;com.xhaus.modjy.ModjyJServlet&lt;/servlet-class&gt;

        &lt;init-param&gt;
            &lt;param-name&gt;python.home&lt;/param-name&gt;
            &lt;param-value&gt;/Applications/jython/jython2.5.0/&lt;/param-value&gt;
        &lt;/init-param&gt;

        &lt;init-param&gt;
            &lt;param-name&gt;python.cachedir.skip&lt;/param-name&gt;
            &lt;param-value&gt;true&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;!--
        There are two different ways you can specify an application to
        modjy
        1. Using the app_import_name mechanism
        2. Using a combination of
        app_directory/app_filename/app_callable_name
        Examples of both are given below
        See the documentation for more details.
        http://modjy.xhaus.com/locating.html#locating_callables
        --&gt;
        &lt;!--
        This is the app_import_name mechanism. If you specify a value
        for this variable, then it will take precedence over the other
        mechanism
        &lt;init-param&gt;
            &lt;param-name&gt;app_import_name&lt;/param-name&gt;
            &lt;param-value&gt;my_wsgi_module.my_handler_class().handler_method&lt;/param-value&gt;
        &lt;/init-param&gt;
        --&gt;
        &lt;!--
        And this is the app_directory/app_filename/app_callable_name
        combo
        The defaults for these three variables are
        ""/application.py/handler
        So if you specify no values at all for any of app_* variables,
        then modjy
        will by default look for "handler" in "application.py" in the
        servlet
        context root.
        &lt;init-param&gt;
            &lt;param-name&gt;app_directory&lt;/param-name&gt;
            &lt;param-value&gt;some_sub_directory&lt;/param-value&gt;
        &lt;/init-param&gt;
        --&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;app_filename&lt;/param-name&gt;
            &lt;param-value&gt;demo_app.py&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;!--
        Supply a value for this parameter if you want your application
        callable to have a different name than the default.
        &lt;init-param&gt;
            &lt;param-name&gt;app_callable_name&lt;/param-name&gt;
            &lt;param-value&gt;my_handler_func&lt;/param-value&gt;
        &lt;/init-param&gt;
        --&gt;
        &lt;!-- Do you want application callables to be cached? --&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;cache_callables&lt;/param-name&gt;
            &lt;param-value&gt;1&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;!-- Should the application be reloaded if it's .py file changes?
        --&gt;
        &lt;!-- Does not work with the app_import_name mechanism --&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;reload_on_mod&lt;/param-name&gt;
            &lt;param-value&gt;1&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;log_level&lt;/param-name&gt;
            &lt;param-value&gt;debug&lt;/param-value&gt;
            &lt;!-- &lt;param-value&gt;info&lt;/param-value&gt; --&gt;
            &lt;!-- &lt;param-value&gt;warn&lt;/param-value&gt; --&gt;
            &lt;!-- &lt;param-value&gt;error&lt;/param-value&gt; --&gt;
            &lt;!-- &lt;param-value&gt;fatal&lt;/param-value&gt; --&gt;
        &lt;/init-param&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;modjy&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</pre>
</div>
<p>The demo_app should be coded as shown in Listing 13-12. As part of
the WSGI standard, the application provides a function that the
server calls for each request. In this case, that function is named
<em>handler</em>. The function must take two parameters, the first being a
dictionary of CGI-defined environment variables. The second is a
callback that returns the HTTP headers. The callback function
should also be called as follows
<em>start_response(status, response_headers, exx_info=None)</em>, where
status is an HTTP status, response_headers is a list of HTTP
headers, and exc_info is for exception handling. Let’s take a look
at the <em>demo_app.py</em> application and identify the features we’ve
just discussed.</p>
<p><em>Listing 13-12.</em></p>
<div class="highlight-python"><pre>import sys
import string

def escape_html(s):
    return s.replace('&amp;', '&amp;amp;').replace('&lt;', '&amp;lt;').replace('&gt;', '&amp;gt;')

def cutoff(s, n=100):
    if len(s) &gt; n: return s[:n]+ '.. cut ..'
    return s

def handler(environ, start_response):
    writer = start_response("200 OK", [ ('content-type', 'text/html') ])
    response_parts = '''&lt;html&gt;&lt;head&gt;
        &lt;title&gt;Modjy demo WSGI application running on Local Server!&lt;/title&gt;
        &lt;/head&gt;
        &lt;body&gt;
        &lt;p&gt;Modjy servlet running correctly:
        jython $version on $platform:
        &lt;/p&gt;
        &lt;h3&gt;Hello jython WSGI on your local server!&lt;/h3&gt;
        &lt;h4&gt;Here are the contents of the WSGI environment&lt;/h4&gt;'''
    environ_str = "&lt;table border='1'&gt;"
    keys = environ.keys()
    keys.sort()
    for ix, name in enumerate(keys):
        if ix % 2:
            background='#ffffff'
        else:
            background='#eeeeee'
        style = " style='background-color:%s;'" % background
        value = escape_html(cutoff(str(environ[name]))) or '&amp;#160;'
        environ_str = "%s\\n&lt;tr&gt;&lt;td%s&gt;%s&lt;/td&gt;&lt;td%s&gt;%s&lt;/td&gt;&lt;/tr&gt;" % \\
            (environ_str, style, name, style, value)
    environ_str = "%s\\n&lt;/table&gt;" % environ_str
    response_parts = response_parts + environ_str + '&lt;/body&gt;&lt;/html&gt;\\n'
    response_text = string.Template(response_parts)
    return [response_text.substitute(version=sys.version, platform=sys.platform)]</pre>
</div>
<p>This application returns the environment configuration for the
server on which you run the application. As you can see, the page
is quite simple to code and really resembles a servlet.</p>
<p>Once the application has been set up and configured, simply compile
the code into a WAR file and deploy it to the Java servlet
container of your choice. In this case, we used Glassfish V2 and it
worked nicely. However, this same application should be deployable
to Tomcat, JBoss, or the like.</p>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>There are various ways that we can use Jython for creating simple
web-based applications. Jython servlets are a good way to make
content available on the web, and you can also utilize them along
with a JSP page which allows for a Model-View-Controller situation.
This is a good technique to use for developing sophisticated web
applications, especially those mixing some JavaScript into the
action because it really helps to organize things. Most Java web
applications use frameworks or other techniques in order to help
organize applications in such a way as to apply the MVC concept. It
is great to have a way to do such work with Jython as well.</p>
<p>This chapter also discussed creation of WSGI applications in Jython
making use of modjy. This is a good low-level way to generate web
applications as well, although modjy and WSGI are usually used for
implementing web frameworks and the like. Solutions such as Django
use WSGI in order to follow the standard put forth for all Python
web frameworks with PEP 333. You can see from the section in this
chapter that WSGI is also a nice quick way to write web
applications, much like writing a servlet in Jython.</p>
<p>In the next chapters, you will learn more about using web
frameworks available to Jython, specifically Django and Pylons.
These two frameworks can make any web developers life much easier,
and now that they are available on the Java platform via Jython
they are even more powerful. Using a templating technique such as
Django can be really productive and it is a good way to design a
full-blown web application. Techniques discussed in this chapter
can also be used for developing large web applications, but using a
standard framework such as those discussed in the following chapter
should be considered. There are many great ways to code Jython web
applications today, and the options continue to grow!</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">Chapter 13: Simple Web Applications</a><ul>
<li><a class="reference external" href="#servlets">Servlets</a><ul>
<li><a class="reference external" href="#configuring-your-web-application-for-jython-servlets">Configuring Your Web Application for Jython Servlets</a></li>
<li><a class="reference external" href="#writing-a-simple-servlet">Writing a Simple Servlet</a></li>
<li><a class="reference external" href="#using-jsp-with-jython">Using JSP with Jython</a><ul>
<li><a class="reference external" href="#configuring-for-jsp">Configuring for JSP</a></li>
<li><a class="reference external" href="#coding-the-controller-view">Coding the Controller/View</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference external" href="#applets-and-java-web-start">Applets and Java Web Start</a><ul>
<li><a class="reference external" href="#coding-a-simple-gui-based-web-application">Coding a Simple GUI-Based Web Application</a><ul>
<li><a class="reference external" href="#object-factory-application-design">Object Factory Application Design</a></li>
</ul>
</li>
<li><a class="reference external" href="#distributing-via-standalone-jar">Distributing via Standalone JAR</a></li>
</ul>
</li>
<li><a class="reference external" href="#wsgi-and-modjy">WSGI and Modjy</a><ul>
<li><a class="reference external" href="#running-a-modjy-application-in-glassfish">Running a Modjy Application in Glassfish</a></li>
</ul>
</li>
<li><a class="reference external" href="#summary">Summary</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="DatabasesAndJython.html"
                                  title="previous chapter">Chapter 12: Databases and Jython: Object Relational Mapping and Using JDBC</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="JythonDjango.html"
                                  title="next chapter">Chapter 14: Web Applications With Django</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/SimpleWebApps.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="JythonDjango.html" title="Chapter 14: Web Applications With Django"
             >next</a> |</li>
        <li class="right" >
          <a href="DatabasesAndJython.html" title="Chapter 12: Databases and Jython: Object Relational Mapping and Using JDBC"
             >previous</a> |</li>
        <li><a href="index.html">Jython Book v1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
  
    <div class="footer">
      &copy; Copyright 2009,2010, Josh Juneau, Frank Wierzbicki, Jim Baker, Leo Soto, Victor Ng.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.5.
    </div>
    <script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-13131153-1");
pageTracker._trackPageview();
} catch(err) {}</script>
  </body>
</html>