<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>9.3. decimal — Decimal fixed point and floating point arithmetic &mdash; Jython v2.5.2 documentation</title>
    <link rel="stylesheet" href="../_static/green-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.5.2',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="Jython v2.5.2 documentation" href="../index.html" />
    <link rel="up" title="9. Numeric and Mathematical Modules" href="numeric.html" />
    <link rel="next" title="9.4. random — Generate pseudo-random numbers" href="random.html" />
    <link rel="prev" title="9.2. cmath — Mathematical functions for complex numbers" href="cmath.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="random.html" title="9.4. random — Generate pseudo-random numbers"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="cmath.html" title="9.2. cmath — Mathematical functions for complex numbers"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Jython v2.5.2 documentation</a> &raquo;</li>
          <li><a href="indexprogress.html" >The Python Standard Library and What Comes with Jython</a> &raquo;</li>
          <li><a href="numeric.html" accesskey="U">9. Numeric and Mathematical Modules</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/jython.png" alt="Logo"/>
            </a></p>
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">9.3. <tt class="docutils literal"><span class="pre">decimal</span></tt> &#8212; Decimal fixed point and floating point arithmetic</a><ul>
<li><a class="reference external" href="#quick-start-tutorial">9.3.1. Quick-start Tutorial</a></li>
<li><a class="reference external" href="#decimal-objects">9.3.2. Decimal objects</a><ul>
<li><a class="reference external" href="#logical-operands">9.3.2.1. Logical operands</a></li>
</ul>
</li>
<li><a class="reference external" href="#context-objects">9.3.3. Context objects</a></li>
<li><a class="reference external" href="#signals">9.3.4. Signals</a></li>
<li><a class="reference external" href="#floating-point-notes">9.3.5. Floating Point Notes</a><ul>
<li><a class="reference external" href="#mitigating-round-off-error-with-increased-precision">9.3.5.1. Mitigating round-off error with increased precision</a></li>
<li><a class="reference external" href="#special-values">9.3.5.2. Special values</a></li>
</ul>
</li>
<li><a class="reference external" href="#working-with-threads">9.3.6. Working with threads</a></li>
<li><a class="reference external" href="#recipes">9.3.7. Recipes</a></li>
<li><a class="reference external" href="#decimal-faq">9.3.8. Decimal FAQ</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="cmath.html"
                                  title="previous chapter">9.2. <tt class="docutils literal docutils literal"><span class="pre">cmath</span></tt> &#8212; Mathematical functions for complex numbers</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="random.html"
                                  title="next chapter">9.4. <tt class="docutils literal"><span class="pre">random</span></tt> &#8212; Generate pseudo-random numbers</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/library/decimal.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="decimal-decimal-fixed-point-and-floating-point-arithmetic">
<h1>9.3. <tt class="docutils literal"><span class="pre">decimal</span></tt> &#8212; Decimal fixed point and floating point arithmetic<a class="headerlink" href="#decimal-decimal-fixed-point-and-floating-point-arithmetic" title="Permalink to this headline">¶</a></h1>
<p>New in version 2.4.</p>
<p>The <tt class="docutils literal"><span class="pre">decimal</span></tt> module provides support for decimal floating point
arithmetic.  It offers several advantages over the <tt class="docutils literal"><span class="pre">float</span></tt> datatype:</p>
<ul>
<li><p class="first">Decimal &#8220;is based on a floating-point model which was designed with
people in mind, and necessarily has a paramount guiding principle &#8211;
computers must provide an arithmetic that works in the same way as
the arithmetic that people learn at school.&#8221; &#8211; excerpt from the
decimal arithmetic specification.</p>
</li>
<li><p class="first">Decimal numbers can be represented exactly.  In contrast, numbers
like <tt class="docutils literal"><span class="pre">1.1</span></tt> do not have an exact representation in binary floating
point. End users typically would not expect <tt class="docutils literal"><span class="pre">1.1</span></tt> to display as
<tt class="docutils literal"><span class="pre">1.1000000000000001</span></tt> as it does with binary floating point.</p>
</li>
<li><p class="first">The exactness carries over into arithmetic.  In decimal floating
point, <tt class="docutils literal"><span class="pre">0.1</span> <span class="pre">+</span> <span class="pre">0.1</span> <span class="pre">+</span> <span class="pre">0.1</span> <span class="pre">-</span> <span class="pre">0.3</span></tt> is exactly equal to zero.  In
binary floating point, the result is <tt class="docutils literal"><span class="pre">5.5511151231257827e-017</span></tt>.
While near to zero, the differences prevent reliable equality
testing and differences can accumulate. For this reason, decimal is
preferred in accounting applications which have strict equality
invariants.</p>
</li>
<li><p class="first">The decimal module incorporates a notion of significant places so
that <tt class="docutils literal"><span class="pre">1.30</span> <span class="pre">+</span> <span class="pre">1.20</span></tt> is <tt class="docutils literal"><span class="pre">2.50</span></tt>.  The trailing zero is kept to
indicate significance. This is the customary presentation for
monetary applications. For multiplication, the &#8220;schoolbook&#8221; approach
uses all the figures in the multiplicands.  For instance, <tt class="docutils literal"><span class="pre">1.3</span> <span class="pre">*</span>
<span class="pre">1.2</span></tt> gives <tt class="docutils literal"><span class="pre">1.56</span></tt> while <tt class="docutils literal"><span class="pre">1.30</span> <span class="pre">*</span> <span class="pre">1.20</span></tt> gives <tt class="docutils literal"><span class="pre">1.5600</span></tt>.</p>
</li>
<li><p class="first">Unlike hardware based binary floating point, the decimal module has
a user alterable precision (defaulting to 28 places) which can be as
large as needed for a given problem:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">getcontext</span><span class="p">()</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="mi">6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="go">Decimal(&#39;0.142857&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getcontext</span><span class="p">()</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="mi">28</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="go">Decimal(&#39;0.1428571428571428571428571429&#39;)</span>
</pre></div>
</div>
</li>
<li><p class="first">Both binary and decimal floating point are implemented in terms of
published standards.  While the built-in float type exposes only a
modest portion of its capabilities, the decimal module exposes all
required parts of the standard. When needed, the programmer has full
control over rounding and signal handling. This includes an option
to enforce exact arithmetic by using exceptions to block any inexact
operations.</p>
</li>
<li><p class="first">The decimal module was designed to support &#8220;without prejudice, both
exact unrounded decimal arithmetic (sometimes called fixed-point
arithmetic) and rounded floating-point arithmetic.&#8221;  &#8211; excerpt from
the decimal arithmetic specification.</p>
</li>
</ul>
<p>The module design is centered around three concepts:  the decimal
number, the context for arithmetic, and signals.</p>
<p>A decimal number is immutable.  It has a sign, coefficient digits, and
an exponent.  To preserve significance, the coefficient digits do not
truncate trailing zeros.  Decimals also include special values such as
<tt class="docutils literal"><span class="pre">Infinity</span></tt>, <tt class="docutils literal"><span class="pre">-Infinity</span></tt>, and <tt class="docutils literal"><span class="pre">NaN</span></tt>.  The standard also
differentiates <tt class="docutils literal"><span class="pre">-0</span></tt> from <tt class="docutils literal"><span class="pre">+0</span></tt>.</p>
<p>The context for arithmetic is an environment specifying precision,
rounding rules, limits on exponents, flags indicating the results of
operations, and trap enablers which determine whether signals are
treated as exceptions.  Rounding options include <tt class="docutils literal"><span class="pre">ROUND_CEILING</span></tt>,
<tt class="docutils literal"><span class="pre">ROUND_DOWN</span></tt>, <tt class="docutils literal"><span class="pre">ROUND_FLOOR</span></tt>, <tt class="docutils literal"><span class="pre">ROUND_HALF_DOWN</span></tt>,
<tt class="docutils literal"><span class="pre">ROUND_HALF_EVEN</span></tt>, <tt class="docutils literal"><span class="pre">ROUND_HALF_UP</span></tt>, <tt class="docutils literal"><span class="pre">ROUND_UP</span></tt>, and
<tt class="docutils literal"><span class="pre">ROUND_05UP</span></tt>.</p>
<p>Signals are groups of exceptional conditions arising during the course
of computation.  Depending on the needs of the application, signals
may be ignored, considered as informational, or treated as exceptions.
The signals in the decimal module are: <tt class="docutils literal"><span class="pre">Clamped</span></tt>,
<tt class="docutils literal"><span class="pre">InvalidOperation</span></tt>, <tt class="docutils literal"><span class="pre">DivisionByZero</span></tt>, <tt class="docutils literal"><span class="pre">Inexact</span></tt>, <tt class="docutils literal"><span class="pre">Rounded</span></tt>,
<tt class="docutils literal"><span class="pre">Subnormal</span></tt>, <tt class="docutils literal"><span class="pre">Overflow</span></tt>, and <tt class="docutils literal"><span class="pre">Underflow</span></tt>.</p>
<p>For each signal there is a flag and a trap enabler.  When a signal is
encountered, its flag is set to one, then, if the trap enabler is set
to one, an exception is raised.  Flags are sticky, so the user needs
to reset them before monitoring a calculation.</p>
<p>See also:</p>
<blockquote>
<ul class="simple">
<li>IBM&#8217;s General Decimal Arithmetic Specification, The General
Decimal Arithmetic Specification.</li>
<li>IEEE standard 854-1987, Unofficial IEEE 854 Text.</li>
</ul>
</blockquote>
<div class="section" id="quick-start-tutorial">
<h2>9.3.1. Quick-start Tutorial<a class="headerlink" href="#quick-start-tutorial" title="Permalink to this headline">¶</a></h2>
<p>The usual start to using decimals is importing the module, viewing the
current context with <tt class="docutils literal"><span class="pre">getcontext()</span></tt> and, if necessary, setting new
values for precision, rounding, or enabled traps:</p>
<blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getcontext</span><span class="p">()</span>
<span class="go">Context(prec=28, rounding=ROUND_HALF_EVEN, Emin=-999999999, Emax=999999999,</span>
<span class="go">        capitals=1, flags=[], traps=[Overflow, DivisionByZero,</span>
<span class="go">        InvalidOperation])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">getcontext</span><span class="p">()</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="mi">7</span>       <span class="c"># Set a new precision</span>
</pre></div>
</div>
</blockquote>
<p>Decimal instances can be constructed from integers, strings, or
tuples.  To create a Decimal from a <tt class="docutils literal"><span class="pre">float</span></tt>, first convert it to a
string.  This serves as an explicit reminder of the details of the
conversion (including representation error).  Decimal numbers include
special values such as <tt class="docutils literal"><span class="pre">NaN</span></tt> which stands for &#8220;Not a number&#8221;,
positive and negative <tt class="docutils literal"><span class="pre">Infinity</span></tt>, and <tt class="docutils literal"><span class="pre">-0</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">getcontext</span><span class="p">()</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="mi">28</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">Decimal(&#39;10&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.14&#39;</span><span class="p">)</span>
<span class="go">Decimal(&#39;3.14&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="o">-</span><span class="mi">2</span><span class="p">))</span>
<span class="go">Decimal(&#39;3.14&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="go">Decimal(&#39;1.41421356237&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;0.5&#39;</span><span class="p">)</span>
<span class="go">Decimal(&#39;1.414213562373095048801688724&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;NaN&#39;</span><span class="p">)</span>
<span class="go">Decimal(&#39;NaN&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;-Infinity&#39;</span><span class="p">)</span>
<span class="go">Decimal(&#39;-Infinity&#39;)</span>
</pre></div>
</div>
<p>The significance of a new Decimal is determined solely by the number
of digits input.  Context precision and rounding only come into play
during arithmetic operations.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">getcontext</span><span class="p">()</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="mi">6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.0&#39;</span><span class="p">)</span>
<span class="go">Decimal(&#39;3.0&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.1415926535&#39;</span><span class="p">)</span>
<span class="go">Decimal(&#39;3.1415926535&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.1415926535&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;2.7182818285&#39;</span><span class="p">)</span>
<span class="go">Decimal(&#39;5.85987&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getcontext</span><span class="p">()</span><span class="o">.</span><span class="n">rounding</span> <span class="o">=</span> <span class="n">ROUND_UP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.1415926535&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;2.7182818285&#39;</span><span class="p">)</span>
<span class="go">Decimal(&#39;5.85988&#39;)</span>
</pre></div>
</div>
<p>Decimals interact well with much of the rest of Python.  Here is a
small decimal floating point flying circus:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">Decimal</span><span class="p">,</span> <span class="s">&#39;1.34 1.87 3.45 2.35 1.00 0.03 9.25&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">Decimal(&#39;9.25&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">Decimal(&#39;0.03&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">[Decimal(&#39;0.03&#39;), Decimal(&#39;1.00&#39;), Decimal(&#39;1.34&#39;), Decimal(&#39;1.87&#39;),</span>
<span class="go"> Decimal(&#39;2.35&#39;), Decimal(&#39;3.45&#39;), Decimal(&#39;9.25&#39;)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">Decimal(&#39;19.29&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">&#39;1.34&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">1.3400000000000001</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">round</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>     <span class="c"># round() first converts to binary floating point</span>
<span class="go">1.3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">*</span> <span class="mi">5</span>
<span class="go">Decimal(&#39;6.70&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
<span class="go">Decimal(&#39;2.5058&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">%</span> <span class="n">a</span>
<span class="go">Decimal(&#39;0.77&#39;)</span>
</pre></div>
</div>
<p>And some mathematical functions are also available to Decimal:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">getcontext</span><span class="p">()</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="mi">28</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span>
<span class="go">Decimal(&#39;1.414213562373095048801688724&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span>
<span class="go">Decimal(&#39;2.718281828459045235360287471&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;10&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ln</span><span class="p">()</span>
<span class="go">Decimal(&#39;2.302585092994045684017991455&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;10&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">log10</span><span class="p">()</span>
<span class="go">Decimal(&#39;1&#39;)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">quantize()</span></tt> method rounds a number to a fixed exponent.  This
method is useful for monetary applications that often round results to
a fixed number of places:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;7.325&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;.01&#39;</span><span class="p">),</span> <span class="n">rounding</span><span class="o">=</span><span class="n">ROUND_DOWN</span><span class="p">)</span>
<span class="go">Decimal(&#39;7.32&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;7.325&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;1.&#39;</span><span class="p">),</span> <span class="n">rounding</span><span class="o">=</span><span class="n">ROUND_UP</span><span class="p">)</span>
<span class="go">Decimal(&#39;8&#39;)</span>
</pre></div>
</div>
<p>As shown above, the <tt class="docutils literal"><span class="pre">getcontext()</span></tt> function accesses the current
context and allows the settings to be changed.  This approach meets
the needs of most applications.</p>
<p>For more advanced work, it may be useful to create alternate contexts
using the Context() constructor.  To make an alternate active, use the
<tt class="docutils literal"><span class="pre">setcontext()</span></tt> function.</p>
<p>In accordance with the standard, the <tt class="docutils literal"><span class="pre">Decimal</span></tt> module provides two
ready to use standard contexts, <tt class="docutils literal"><span class="pre">BasicContext</span></tt> and
<tt class="docutils literal"><span class="pre">ExtendedContext</span></tt>. The former is especially useful for debugging
because many of the traps are enabled:</p>
<blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">myothercontext</span> <span class="o">=</span> <span class="n">Context</span><span class="p">(</span><span class="n">prec</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">rounding</span><span class="o">=</span><span class="n">ROUND_HALF_DOWN</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">setcontext</span><span class="p">(</span><span class="n">myothercontext</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="go">Decimal(&#39;0.142857142857142857142857142857142857142857142857142857142857&#39;)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ExtendedContext</span>
<span class="go">Context(prec=9, rounding=ROUND_HALF_EVEN, Emin=-999999999, Emax=999999999,</span>
<span class="go">        capitals=1, flags=[], traps=[])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">setcontext</span><span class="p">(</span><span class="n">ExtendedContext</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="go">Decimal(&#39;0.142857143&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">Decimal(&#39;Infinity&#39;)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">setcontext</span><span class="p">(</span><span class="n">BasicContext</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;pyshell#143&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n-Identifier">-toplevel-</span>
    <span class="n">Decimal</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nc">DivisionByZero</span>: <span class="n-Identifier">x / 0</span>
</pre></div>
</div>
</blockquote>
<p>Contexts also have signal flags for monitoring exceptional conditions
encountered during computations.  The flags remain set until
explicitly cleared, so it is best to clear the flags before each set
of monitored computations by using the <tt class="docutils literal"><span class="pre">clear_flags()</span></tt> method.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">setcontext</span><span class="p">(</span><span class="n">ExtendedContext</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getcontext</span><span class="p">()</span><span class="o">.</span><span class="n">clear_flags</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="mi">355</span><span class="p">)</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">113</span><span class="p">)</span>
<span class="go">Decimal(&#39;3.14159292&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getcontext</span><span class="p">()</span>
<span class="go">Context(prec=9, rounding=ROUND_HALF_EVEN, Emin=-999999999, Emax=999999999,</span>
<span class="go">        capitals=1, flags=[Rounded, Inexact], traps=[])</span>
</pre></div>
</div>
<p>The <em>flags</em> entry shows that the rational approximation to <tt class="docutils literal"><span class="pre">Pi</span></tt> was
rounded (digits beyond the context precision were thrown away) and
that the result is inexact (some of the discarded digits were non-
zero).</p>
<p>Individual traps are set using the dictionary in the <tt class="docutils literal"><span class="pre">traps</span></tt> field
of a context:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">setcontext</span><span class="p">(</span><span class="n">ExtendedContext</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">Decimal(&#39;Infinity&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getcontext</span><span class="p">()</span><span class="o">.</span><span class="n">traps</span><span class="p">[</span><span class="n">DivisionByZero</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;pyshell#112&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n-Identifier">-toplevel-</span>
    <span class="n">Decimal</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nc">DivisionByZero</span>: <span class="n-Identifier">x / 0</span>
</pre></div>
</div>
<p>Most programs adjust the current context only once, at the beginning
of the program.  And, in many applications, data is converted to
<tt class="docutils literal"><span class="pre">Decimal</span></tt> with a single cast inside a loop.  With context set and
decimals created, the bulk of the program manipulates the data no
differently than with other Python numeric types.</p>
</div>
<div class="section" id="decimal-objects">
<h2>9.3.2. Decimal objects<a class="headerlink" href="#decimal-objects" title="Permalink to this headline">¶</a></h2>
<p>class class decimal.Decimal([value[, context]])</p>
<blockquote>
<p>Construct a new <tt class="docutils literal"><span class="pre">Decimal</span></tt> object based from <em>value</em>.</p>
<p><em>value</em> can be an integer, string, tuple, or another <tt class="docutils literal"><span class="pre">Decimal</span></tt>
object. If no <em>value</em> is given, returns <tt class="docutils literal"><span class="pre">Decimal('0')</span></tt>.  If
<em>value</em> is a string, it should conform to the decimal numeric
string syntax after leading and trailing whitespace characters are
removed:</p>
<blockquote>
sign           ::=  &#8216;+&#8217; | &#8216;-&#8216;
digit          ::=  &#8216;0&#8217; | &#8216;1&#8217; | &#8216;2&#8217; | &#8216;3&#8217; | &#8216;4&#8217; | &#8216;5&#8217; | &#8216;6&#8217; | &#8216;7&#8217; | &#8216;8&#8217; | &#8216;9&#8217;
indicator      ::=  &#8216;e&#8217; | &#8216;E&#8217;
digits         ::=  digit [digit]...
decimal-part   ::=  digits &#8216;.&#8217; [digits] | [&#8216;.&#8217;] digits
exponent-part  ::=  indicator [sign] digits
infinity       ::=  &#8216;Infinity&#8217; | &#8216;Inf&#8217;
nan            ::=  &#8216;NaN&#8217; [digits] | &#8216;sNaN&#8217; [digits]
numeric-value  ::=  decimal-part [exponent-part] | infinity
numeric-string ::=  [sign] numeric-value | [sign] nan</blockquote>
<p>If <em>value</em> is a <tt class="docutils literal"><span class="pre">tuple</span></tt>, it should have three components, a sign
(<tt class="docutils literal"><span class="pre">0</span></tt> for positive or <tt class="docutils literal"><span class="pre">1</span></tt> for negative), a <tt class="docutils literal"><span class="pre">tuple</span></tt> of digits,
and an integer exponent. For example, <tt class="docutils literal"><span class="pre">Decimal((0,</span> <span class="pre">(1,</span> <span class="pre">4,</span> <span class="pre">1,</span> <span class="pre">4),</span>
<span class="pre">-3))</span></tt> returns <tt class="docutils literal"><span class="pre">Decimal('1.414')</span></tt>.</p>
<p>The <em>context</em> precision does not affect how many digits are stored.
That is determined exclusively by the number of digits in <em>value</em>.
For example, <tt class="docutils literal"><span class="pre">Decimal('3.00000')</span></tt> records all five zeros even if
the context precision is only three.</p>
<p>The purpose of the <em>context</em> argument is determining what to do if
<em>value</em> is a malformed string.  If the context traps
<tt class="docutils literal"><span class="pre">InvalidOperation</span></tt>, an exception is raised; otherwise, the
constructor returns a new Decimal with the value of <tt class="docutils literal"><span class="pre">NaN</span></tt>.</p>
<p>Once constructed, <tt class="docutils literal"><span class="pre">Decimal</span></tt> objects are immutable.</p>
<p>Changed in version 2.6: leading and trailing whitespace characters
are permitted when creating a Decimal instance from a string.</p>
<p>Decimal floating point objects share many properties with the other
built-in numeric types such as <tt class="docutils literal"><span class="pre">float</span></tt> and <tt class="docutils literal"><span class="pre">int</span></tt>.  All of the
usual math operations and special methods apply.  Likewise, decimal
objects can be copied, pickled, printed, used as dictionary keys,
used as set elements, compared, sorted, and coerced to another type
(such as <tt class="docutils literal"><span class="pre">float</span></tt> or <tt class="docutils literal"><span class="pre">long</span></tt>).</p>
<p>In addition to the standard numeric properties, decimal floating
point objects also have a number of specialized methods:</p>
<p>adjusted()</p>
<blockquote>
Return the adjusted exponent after shifting out the
coefficient&#8217;s rightmost digits until only the lead digit
remains: <tt class="docutils literal"><span class="pre">Decimal('321e+5').adjusted()</span></tt> returns seven.  Used
for determining the position of the most significant digit with
respect to the decimal point.</blockquote>
<p>as_tuple()</p>
<blockquote>
<p>Return a <em>named tuple</em> representation of the number:
<tt class="docutils literal"><span class="pre">DecimalTuple(sign,</span> <span class="pre">digits,</span> <span class="pre">exponent)</span></tt>.</p>
<p>Changed in version 2.6: Use a named tuple.</p>
</blockquote>
<p>canonical()</p>
<blockquote>
<p>Return the canonical encoding of the argument.  Currently, the
encoding of a <tt class="docutils literal"><span class="pre">Decimal</span></tt> instance is always canonical, so this
operation returns its argument unchanged.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>compare(other[, context])</p>
<blockquote>
<p>Compare the values of two Decimal instances.  This operation
behaves in the same way as the usual comparison method
<tt class="docutils literal"><span class="pre">__cmp__()</span></tt>, except that <tt class="docutils literal"><span class="pre">compare()</span></tt> returns a Decimal
instance rather than an integer, and if either operand is a NaN
then the result is a NaN:</p>
<blockquote>
a or b is a NaN ==&gt; Decimal(&#8216;NaN&#8217;)
a &lt; b           ==&gt; Decimal(&#8216;-1&#8217;)
a == b          ==&gt; Decimal(&#8216;0&#8217;)
a &gt; b           ==&gt; Decimal(&#8216;1&#8217;)</blockquote>
</blockquote>
<p>compare_signal(other[, context])</p>
<blockquote>
<p>This operation is identical to the <tt class="docutils literal"><span class="pre">compare()</span></tt> method, except
that all NaNs signal.  That is, if neither operand is a
signaling NaN then any quiet NaN operand is treated as though it
were a signaling NaN.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>compare_total(other)</p>
<blockquote>
<p>Compare two operands using their abstract representation rather
than their numerical value.  Similar to the <tt class="docutils literal"><span class="pre">compare()</span></tt>
method, but the result gives a total ordering on <tt class="docutils literal"><span class="pre">Decimal</span></tt>
instances.  Two <tt class="docutils literal"><span class="pre">Decimal</span></tt> instances with the same numeric
value but different representations compare unequal in this
ordering:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;12.0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compare_total</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;12&#39;</span><span class="p">))</span>
<span class="go">Decimal(&#39;-1&#39;)</span>
</pre></div>
</div>
<p>Quiet and signaling NaNs are also included in the total
ordering.  The result of this function is <tt class="docutils literal"><span class="pre">Decimal('0')</span></tt> if
both operands have the same representation, <tt class="docutils literal"><span class="pre">Decimal('-1')</span></tt> if
the first operand is lower in the total order than the second,
and <tt class="docutils literal"><span class="pre">Decimal('1')</span></tt> if the first operand is higher in the total
order than the second operand.  See the specification for
details of the total order.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>compare_total_mag(other)</p>
<blockquote>
<p>Compare two operands using their abstract representation rather
than their value as in <tt class="docutils literal"><span class="pre">compare_total()</span></tt>, but ignoring the
sign of each operand. <tt class="docutils literal"><span class="pre">x.compare_total_mag(y)</span></tt> is equivalent
to <tt class="docutils literal"><span class="pre">x.copy_abs().compare_total(y.copy_abs())</span></tt>.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>conjugate()</p>
<blockquote>
<p>Just returns self, this method is only to comply with the
Decimal Specification.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>copy_abs()</p>
<blockquote>
<p>Return the absolute value of the argument.  This operation is
unaffected by the context and is quiet: no flags are changed and
no rounding is performed.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>copy_negate()</p>
<blockquote>
<p>Return the negation of the argument.  This operation is
unaffected by the context and is quiet: no flags are changed and
no rounding is performed.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>copy_sign(other)</p>
<blockquote>
<p>Return a copy of the first operand with the sign set to be the
same as the sign of the second operand.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;2.3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">copy_sign</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;-1.5&#39;</span><span class="p">))</span>
<span class="go">Decimal(&#39;-2.3&#39;)</span>
</pre></div>
</div>
<p>This operation is unaffected by the context and is quiet: no
flags are changed and no rounding is performed.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>exp([context])</p>
<blockquote>
<p>Return the value of the (natural) exponential function <tt class="docutils literal"><span class="pre">e**x</span></tt>
at the given number.  The result is correctly rounded using the
<tt class="docutils literal"><span class="pre">ROUND_HALF_EVEN</span></tt> rounding mode.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span>
<span class="go">Decimal(&#39;2.718281828459045235360287471&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="mi">321</span><span class="p">)</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span>
<span class="go">Decimal(&#39;2.561702493119680037517373933E+139&#39;)</span>
</pre></div>
</div>
<p>New in version 2.6.</p>
</blockquote>
<p>fma(other, third[, context])</p>
<blockquote>
<p>Fused multiply-add.  Return self*other+third with no rounding of
the intermediate product self*other.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">fma</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="go">Decimal(&#39;11&#39;)</span>
</pre></div>
</div>
<p>New in version 2.6.</p>
</blockquote>
<p>is_canonical()</p>
<blockquote>
<p>Return <tt class="xref docutils literal"><span class="pre">True</span></tt> if the argument is canonical and <tt class="xref docutils literal"><span class="pre">False</span></tt>
otherwise.  Currently, a <tt class="docutils literal"><span class="pre">Decimal</span></tt> instance is always
canonical, so this operation always returns <tt class="xref docutils literal"><span class="pre">True</span></tt>.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>is_finite()</p>
<blockquote>
<p>Return <tt class="xref docutils literal"><span class="pre">True</span></tt> if the argument is a finite number, and
<tt class="xref docutils literal"><span class="pre">False</span></tt> if the argument is an infinity or a NaN.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>is_infinite()</p>
<blockquote>
<p>Return <tt class="xref docutils literal"><span class="pre">True</span></tt> if the argument is either positive or negative
infinity and <tt class="xref docutils literal"><span class="pre">False</span></tt> otherwise.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>is_nan()</p>
<blockquote>
<p>Return <tt class="xref docutils literal"><span class="pre">True</span></tt> if the argument is a (quiet or signaling) NaN
and <tt class="xref docutils literal"><span class="pre">False</span></tt> otherwise.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>is_normal()</p>
<blockquote>
<p>Return <tt class="xref docutils literal"><span class="pre">True</span></tt> if the argument is a <em>normal</em> finite number.
Return <tt class="xref docutils literal"><span class="pre">False</span></tt> if the argument is zero, subnormal, infinite or
a NaN.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>is_qnan()</p>
<blockquote>
<p>Return <tt class="xref docutils literal"><span class="pre">True</span></tt> if the argument is a quiet NaN, and <tt class="xref docutils literal"><span class="pre">False</span></tt>
otherwise.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>is_signed()</p>
<blockquote>
<p>Return <tt class="xref docutils literal"><span class="pre">True</span></tt> if the argument has a negative sign and
<tt class="xref docutils literal"><span class="pre">False</span></tt> otherwise.  Note that zeros and NaNs can both carry
signs.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>is_snan()</p>
<blockquote>
<p>Return <tt class="xref docutils literal"><span class="pre">True</span></tt> if the argument is a signaling NaN and <tt class="xref docutils literal"><span class="pre">False</span></tt>
otherwise.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>is_subnormal()</p>
<blockquote>
<p>Return <tt class="xref docutils literal"><span class="pre">True</span></tt> if the argument is subnormal, and <tt class="xref docutils literal"><span class="pre">False</span></tt>
otherwise.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>is_zero()</p>
<blockquote>
<p>Return <tt class="xref docutils literal"><span class="pre">True</span></tt> if the argument is a (positive or negative) zero
and <tt class="xref docutils literal"><span class="pre">False</span></tt> otherwise.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>ln([context])</p>
<blockquote>
<p>Return the natural (base e) logarithm of the operand.  The
result is correctly rounded using the <tt class="docutils literal"><span class="pre">ROUND_HALF_EVEN</span></tt>
rounding mode.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>log10([context])</p>
<blockquote>
<p>Return the base ten logarithm of the operand.  The result is
correctly rounded using the <tt class="docutils literal"><span class="pre">ROUND_HALF_EVEN</span></tt> rounding mode.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>logb([context])</p>
<blockquote>
<p>For a nonzero number, return the adjusted exponent of its
operand as a <tt class="docutils literal"><span class="pre">Decimal</span></tt> instance.  If the operand is a zero
then <tt class="docutils literal"><span class="pre">Decimal('-Infinity')</span></tt> is returned and the
<tt class="docutils literal"><span class="pre">DivisionByZero</span></tt> flag is raised.  If the operand is an
infinity then <tt class="docutils literal"><span class="pre">Decimal('Infinity')</span></tt> is returned.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>logical_and(other[, context])</p>
<blockquote>
<p><tt class="docutils literal"><span class="pre">logical_and()</span></tt> is a logical operation which takes two
<em>logical operands</em> (see <em>Logical operands</em>).  The result is the
digit-wise <tt class="docutils literal"><span class="pre">and</span></tt> of the two operands.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>logical_invert(other[, context])</p>
<blockquote>
<p><tt class="docutils literal"><span class="pre">logical_invert()</span></tt> is a logical operation.  The argument must
be a <em>logical operand</em> (see <em>Logical operands</em>).  The result is
the digit-wise inversion of the operand.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>logical_or(other[, context])</p>
<blockquote>
<p><tt class="docutils literal"><span class="pre">logical_or()</span></tt> is a logical operation which takes two <em>logical
operands</em> (see <em>Logical operands</em>).  The result is the digit-
wise <tt class="docutils literal"><span class="pre">or</span></tt> of the two operands.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>logical_xor(other[, context])</p>
<blockquote>
<p><tt class="docutils literal"><span class="pre">logical_xor()</span></tt> is a logical operation which takes two
<em>logical operands</em> (see <em>Logical operands</em>).  The result is the
digit-wise exclusive or of the two operands.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>max(other[, context])</p>
<blockquote>
Like <tt class="docutils literal"><span class="pre">max(self,</span> <span class="pre">other)</span></tt> except that the context rounding rule
is applied before returning and that <tt class="docutils literal"><span class="pre">NaN</span></tt> values are either
signaled or ignored (depending on the context and whether they
are signaling or quiet).</blockquote>
<p>max_mag(other[, context])</p>
<blockquote>
<p>Similar to the <tt class="docutils literal"><span class="pre">max()</span></tt> method, but the comparison is done
using the absolute values of the operands.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>min(other[, context])</p>
<blockquote>
Like <tt class="docutils literal"><span class="pre">min(self,</span> <span class="pre">other)</span></tt> except that the context rounding rule
is applied before returning and that <tt class="docutils literal"><span class="pre">NaN</span></tt> values are either
signaled or ignored (depending on the context and whether they
are signaling or quiet).</blockquote>
<p>min_mag(other[, context])</p>
<blockquote>
<p>Similar to the <tt class="docutils literal"><span class="pre">min()</span></tt> method, but the comparison is done
using the absolute values of the operands.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>next_minus([context])</p>
<blockquote>
<p>Return the largest number representable in the given context (or
in the current thread&#8217;s context if no context is given) that is
smaller than the given operand.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>next_plus([context])</p>
<blockquote>
<p>Return the smallest number representable in the given context
(or in the current thread&#8217;s context if no context is given) that
is larger than the given operand.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>next_toward(other[, context])</p>
<blockquote>
<p>If the two operands are unequal, return the number closest to
the first operand in the direction of the second operand.  If
both operands are numerically equal, return a copy of the first
operand with the sign set to be the same as the sign of the
second operand.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>normalize([context])</p>
<blockquote>
Normalize the number by stripping the rightmost trailing zeros
and converting any result equal to <tt class="docutils literal"><span class="pre">Decimal('0')</span></tt> to
<tt class="docutils literal"><span class="pre">Decimal('0e0')</span></tt>. Used for producing canonical values for
members of an equivalence class. For example,
<tt class="docutils literal"><span class="pre">Decimal('32.100')</span></tt> and <tt class="docutils literal"><span class="pre">Decimal('0.321000e+2')</span></tt> both
normalize to the equivalent value <tt class="docutils literal"><span class="pre">Decimal('32.1')</span></tt>.</blockquote>
<p>number_class([context])</p>
<blockquote>
<p>Return a string describing the <em>class</em> of the operand.  The
returned value is one of the following ten strings.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">&quot;-Infinity&quot;</span></tt>, indicating that the operand is negative
infinity.</li>
<li><tt class="docutils literal"><span class="pre">&quot;-Normal&quot;</span></tt>, indicating that the operand is a negative
normal number.</li>
<li><tt class="docutils literal"><span class="pre">&quot;-Subnormal&quot;</span></tt>, indicating that the operand is negative and
subnormal.</li>
<li><tt class="docutils literal"><span class="pre">&quot;-Zero&quot;</span></tt>, indicating that the operand is a negative zero.</li>
<li><tt class="docutils literal"><span class="pre">&quot;+Zero&quot;</span></tt>, indicating that the operand is a positive zero.</li>
<li><tt class="docutils literal"><span class="pre">&quot;+Subnormal&quot;</span></tt>, indicating that the operand is positive and
subnormal.</li>
<li><tt class="docutils literal"><span class="pre">&quot;+Normal&quot;</span></tt>, indicating that the operand is a positive
normal number.</li>
<li><tt class="docutils literal"><span class="pre">&quot;+Infinity&quot;</span></tt>, indicating that the operand is positive
infinity.</li>
<li><tt class="docutils literal"><span class="pre">&quot;NaN&quot;</span></tt>, indicating that the operand is a quiet NaN (Not a
Number).</li>
<li><tt class="docutils literal"><span class="pre">&quot;sNaN&quot;</span></tt>, indicating that the operand is a signaling NaN.</li>
</ul>
<p>New in version 2.6.</p>
</blockquote>
<p>quantize(exp[, rounding[, context[, watchexp]]])</p>
<blockquote>
<p>Return a value equal to the first operand after rounding and
having the exponent of the second operand.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;1.41421356&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;1.000&#39;</span><span class="p">))</span>
<span class="go">Decimal(&#39;1.414&#39;)</span>
</pre></div>
</div>
<p>Unlike other operations, if the length of the coefficient after
the quantize operation would be greater than precision, then an
<tt class="docutils literal"><span class="pre">InvalidOperation</span></tt> is signaled. This guarantees that, unless
there is an error condition, the quantized exponent is always
equal to that of the right-hand operand.</p>
<p>Also unlike other operations, quantize never signals Underflow,
even if the result is subnormal and inexact.</p>
<p>If the exponent of the second operand is larger than that of the
first then rounding may be necessary.  In this case, the
rounding mode is determined by the <tt class="docutils literal"><span class="pre">rounding</span></tt> argument if
given, else by the given <tt class="docutils literal"><span class="pre">context</span></tt> argument; if neither
argument is given the rounding mode of the current thread&#8217;s
context is used.</p>
<p>If <em>watchexp</em> is set (default), then an error is returned
whenever the resulting exponent is greater than <tt class="docutils literal"><span class="pre">Emax</span></tt> or less
than <tt class="docutils literal"><span class="pre">Etiny</span></tt>.</p>
</blockquote>
<p>radix()</p>
<blockquote>
<p>Return <tt class="docutils literal"><span class="pre">Decimal(10)</span></tt>, the radix (base) in which the
<tt class="docutils literal"><span class="pre">Decimal</span></tt> class does all its arithmetic.  Included for
compatibility with the specification.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>remainder_near(other[, context])</p>
<blockquote>
<p>Compute the modulo as either a positive or negative value
depending on which is closest to zero.  For instance,
<tt class="docutils literal"><span class="pre">Decimal(10).remainder_near(6)</span></tt> returns <tt class="docutils literal"><span class="pre">Decimal('-2')</span></tt>
which is closer to zero than <tt class="docutils literal"><span class="pre">Decimal('4')</span></tt>.</p>
<p>If both are equally close, the one chosen will have the same
sign as <em>self</em>.</p>
</blockquote>
<p>rotate(other[, context])</p>
<blockquote>
<p>Return the result of rotating the digits of the first operand by
an amount specified by the second operand.  The second operand
must be an integer in the range -precision through precision.
The absolute value of the second operand gives the number of
places to rotate.  If the second operand is positive then
rotation is to the left; otherwise rotation is to the right. The
coefficient of the first operand is padded on the left with
zeros to length precision if necessary.  The sign and exponent
of the first operand are unchanged.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>same_quantum(other[, context])</p>
<blockquote>
Test whether self and other have the same exponent or whether
both are <tt class="docutils literal"><span class="pre">NaN</span></tt>.</blockquote>
<p>scaleb(other[, context])</p>
<blockquote>
<p>Return the first operand with exponent adjusted by the second.
Equivalently, return the first operand multiplied by
<tt class="docutils literal"><span class="pre">10**other</span></tt>.  The second operand must be an integer.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>shift(other[, context])</p>
<blockquote>
<p>Return the result of shifting the digits of the first operand by
an amount specified by the second operand.  The second operand
must be an integer in the range -precision through precision.
The absolute value of the second operand gives the number of
places to shift.  If the second operand is positive then the
shift is to the left; otherwise the shift is to the right.
Digits shifted into the coefficient are zeros.  The sign and
exponent of the first operand are unchanged.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>sqrt([context])</p>
<blockquote>
Return the square root of the argument to full precision.</blockquote>
<p>to_eng_string([context])</p>
<blockquote>
<p>Convert to an engineering-type string.</p>
<p>Engineering notation has an exponent which is a multiple of 3,
so there are up to 3 digits left of the decimal place.  For
example, converts <tt class="docutils literal"><span class="pre">Decimal('123E+1')</span></tt> to
<tt class="docutils literal"><span class="pre">Decimal('1.23E+3')</span></tt></p>
</blockquote>
<p>to_integral([rounding[, context]])</p>
<blockquote>
Identical to the <tt class="docutils literal"><span class="pre">to_integral_value()</span></tt> method.  The
<tt class="docutils literal"><span class="pre">to_integral</span></tt> name has been kept for compatibility with older
versions.</blockquote>
<p>to_integral_exact([rounding[, context]])</p>
<blockquote>
<p>Round to the nearest integer, signaling <tt class="docutils literal"><span class="pre">Inexact</span></tt> or
<tt class="docutils literal"><span class="pre">Rounded</span></tt> as appropriate if rounding occurs.  The rounding
mode is determined by the <tt class="docutils literal"><span class="pre">rounding</span></tt> parameter if given, else
by the given <tt class="docutils literal"><span class="pre">context</span></tt>.  If neither parameter is given then
the rounding mode of the current context is used.</p>
<p>New in version 2.6.</p>
</blockquote>
<p>to_integral_value([rounding[, context]])</p>
<blockquote>
<p>Round to the nearest integer without signaling <tt class="docutils literal"><span class="pre">Inexact</span></tt> or
<tt class="docutils literal"><span class="pre">Rounded</span></tt>.  If given, applies <em>rounding</em>; otherwise, uses the
rounding method in either the supplied <em>context</em> or the current
context.</p>
<p>Changed in version 2.6: renamed from <tt class="docutils literal"><span class="pre">to_integral</span></tt> to
<tt class="docutils literal"><span class="pre">to_integral_value</span></tt>.  The old name remains valid for
compatibility.</p>
</blockquote>
</blockquote>
<div class="section" id="logical-operands">
<h3>9.3.2.1. Logical operands<a class="headerlink" href="#logical-operands" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">logical_and()</span></tt>, <tt class="docutils literal"><span class="pre">logical_invert()</span></tt>, <tt class="docutils literal"><span class="pre">logical_or()</span></tt>, and
<tt class="docutils literal"><span class="pre">logical_xor()</span></tt> methods expect their arguments to be <em>logical
operands</em>.  A <em>logical operand</em> is a <tt class="docutils literal"><span class="pre">Decimal</span></tt> instance whose
exponent and sign are both zero, and whose digits are all either <tt class="docutils literal"><span class="pre">0</span></tt>
or <tt class="docutils literal"><span class="pre">1</span></tt>.</p>
</div>
</div>
<div class="section" id="context-objects">
<h2>9.3.3. Context objects<a class="headerlink" href="#context-objects" title="Permalink to this headline">¶</a></h2>
<p>Contexts are environments for arithmetic operations.  They govern
precision, set rules for rounding, determine which signals are treated
as exceptions, and limit the range for exponents.</p>
<p>Each thread has its own current context which is accessed or changed
using the <tt class="docutils literal"><span class="pre">getcontext()</span></tt> and <tt class="docutils literal"><span class="pre">setcontext()</span></tt> functions:</p>
<p>decimal.getcontext()</p>
<blockquote>
Return the current context for the active thread.</blockquote>
<p>decimal.setcontext(c)</p>
<blockquote>
Set the current context for the active thread to <em>c</em>.</blockquote>
<p>Beginning with Python 2.5, you can also use the <tt class="docutils literal"><span class="pre">with</span></tt> statement and
the <tt class="docutils literal"><span class="pre">localcontext()</span></tt> function to temporarily change the active
context.</p>
<p>decimal.localcontext([c])</p>
<blockquote>
<p>Return a context manager that will set the current context for the
active thread to a copy of <em>c</em> on entry to the with-statement and
restore the previous context when exiting the with-statement. If no
context is specified, a copy of the current context is used.</p>
<p>New in version 2.5.</p>
<p>For example, the following code sets the current decimal precision
to 42 places, performs a calculation, and then automatically
restores the previous context:</p>
<blockquote>
<p>from decimal import localcontext</p>
<dl class="docutils">
<dt>with localcontext() as ctx:</dt>
<dd>ctx.prec = 42   # Perform a high precision calculation
s = calculate_something()</dd>
</dl>
<p>s = +s  # Round the final result back to the default precision</p>
</blockquote>
</blockquote>
<p>New contexts can also be created using the <tt class="docutils literal"><span class="pre">Context</span></tt> constructor
described below. In addition, the module provides three pre-made
contexts:</p>
<p>class class decimal.BasicContext</p>
<blockquote>
<p>This is a standard context defined by the General Decimal
Arithmetic Specification.  Precision is set to nine.  Rounding is
set to <tt class="docutils literal"><span class="pre">ROUND_HALF_UP</span></tt>.  All flags are cleared.  All traps are
enabled (treated as exceptions) except <tt class="docutils literal"><span class="pre">Inexact</span></tt>, <tt class="docutils literal"><span class="pre">Rounded</span></tt>,
and <tt class="docutils literal"><span class="pre">Subnormal</span></tt>.</p>
<p>Because many of the traps are enabled, this context is useful for
debugging.</p>
</blockquote>
<p>class class decimal.ExtendedContext</p>
<blockquote>
<p>This is a standard context defined by the General Decimal
Arithmetic Specification.  Precision is set to nine.  Rounding is
set to <tt class="docutils literal"><span class="pre">ROUND_HALF_EVEN</span></tt>.  All flags are cleared.  No traps are
enabled (so that exceptions are not raised during computations).</p>
<p>Because the traps are disabled, this context is useful for
applications that prefer to have result value of <tt class="docutils literal"><span class="pre">NaN</span></tt> or
<tt class="docutils literal"><span class="pre">Infinity</span></tt> instead of raising exceptions.  This allows an
application to complete a run in the presence of conditions that
would otherwise halt the program.</p>
</blockquote>
<p>class class decimal.DefaultContext</p>
<blockquote>
<p>This context is used by the <tt class="docutils literal"><span class="pre">Context</span></tt> constructor as a prototype
for new contexts.  Changing a field (such a precision) has the
effect of changing the default for new contexts creating by the
<tt class="docutils literal"><span class="pre">Context</span></tt> constructor.</p>
<p>This context is most useful in multi-threaded environments.
Changing one of the fields before threads are started has the
effect of setting system-wide defaults.  Changing the fields after
threads have started is not recommended as it would require thread
synchronization to prevent race conditions.</p>
<p>In single threaded environments, it is preferable to not use this
context at all.  Instead, simply create contexts explicitly as
described below.</p>
<p>The default values are precision=28, rounding=ROUND_HALF_EVEN, and
enabled traps for Overflow, InvalidOperation, and DivisionByZero.</p>
</blockquote>
<p>In addition to the three supplied contexts, new contexts can be
created with the <tt class="docutils literal"><span class="pre">Context</span></tt> constructor.</p>
<p>class class decimal.Context(prec=None, rounding=None, traps=None, flags=None, Emin=None, Emax=None, capitals=1)</p>
<blockquote>
<p>Creates a new context.  If a field is not specified or is <tt class="xref docutils literal"><span class="pre">None</span></tt>,
the default values are copied from the <tt class="docutils literal"><span class="pre">DefaultContext</span></tt>.  If the
<em>flags</em> field is not specified or is <tt class="xref docutils literal"><span class="pre">None</span></tt>, all flags are
cleared.</p>
<p>The <em>prec</em> field is a positive integer that sets the precision for
arithmetic operations in the context.</p>
<p>The <em>rounding</em> option is one of:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">ROUND_CEILING</span></tt> (towards <tt class="docutils literal"><span class="pre">Infinity</span></tt>),</li>
<li><tt class="docutils literal"><span class="pre">ROUND_DOWN</span></tt> (towards zero),</li>
<li><tt class="docutils literal"><span class="pre">ROUND_FLOOR</span></tt> (towards <tt class="docutils literal"><span class="pre">-Infinity</span></tt>),</li>
<li><tt class="docutils literal"><span class="pre">ROUND_HALF_DOWN</span></tt> (to nearest with ties going towards zero),</li>
<li><tt class="docutils literal"><span class="pre">ROUND_HALF_EVEN</span></tt> (to nearest with ties going to nearest even
integer),</li>
<li><tt class="docutils literal"><span class="pre">ROUND_HALF_UP</span></tt> (to nearest with ties going away from zero), or</li>
<li><tt class="docutils literal"><span class="pre">ROUND_UP</span></tt> (away from zero).</li>
<li><tt class="docutils literal"><span class="pre">ROUND_05UP</span></tt> (away from zero if last digit after rounding
towards zero would have been 0 or 5; otherwise towards zero)</li>
</ul>
<p>The <em>traps</em> and <em>flags</em> fields list any signals to be set.
Generally, new contexts should only set traps and leave the flags
clear.</p>
<p>The <em>Emin</em> and <em>Emax</em> fields are integers specifying the outer
limits allowable for exponents.</p>
<p>The <em>capitals</em> field is either <tt class="docutils literal"><span class="pre">0</span></tt> or <tt class="docutils literal"><span class="pre">1</span></tt> (the default). If set
to <tt class="docutils literal"><span class="pre">1</span></tt>, exponents are printed with a capital <tt class="docutils literal"><span class="pre">E</span></tt>; otherwise, a
lowercase <tt class="docutils literal"><span class="pre">e</span></tt> is used: <tt class="docutils literal"><span class="pre">Decimal('6.02e+23')</span></tt>.</p>
<p>Changed in version 2.6: The <tt class="docutils literal"><span class="pre">ROUND_05UP</span></tt> rounding mode was added.</p>
<p>The <tt class="docutils literal"><span class="pre">Context</span></tt> class defines several general purpose methods as
well as a large number of methods for doing arithmetic directly in
a given context. In addition, for each of the <tt class="docutils literal"><span class="pre">Decimal</span></tt> methods
described above (with the exception of the <tt class="docutils literal"><span class="pre">adjusted()</span></tt> and
<tt class="docutils literal"><span class="pre">as_tuple()</span></tt> methods) there is a corresponding <tt class="docutils literal"><span class="pre">Context</span></tt>
method.  For example, <tt class="docutils literal"><span class="pre">C.exp(x)</span></tt> is equivalent to
<tt class="docutils literal"><span class="pre">x.exp(context=C)</span></tt>.</p>
<p>clear_flags()</p>
<blockquote>
Resets all of the flags to <tt class="docutils literal"><span class="pre">0</span></tt>.</blockquote>
<p>copy()</p>
<blockquote>
Return a duplicate of the context.</blockquote>
<p>copy_decimal(num)</p>
<blockquote>
Return a copy of the Decimal instance num.</blockquote>
<p>create_decimal(num)</p>
<blockquote>
<p>Creates a new Decimal instance from <em>num</em> but using <em>self</em> as
context. Unlike the <tt class="docutils literal"><span class="pre">Decimal</span></tt> constructor, the context
precision, rounding method, flags, and traps are applied to the
conversion.</p>
<p>This is useful because constants are often given to a greater
precision than is needed by the application.  Another benefit is
that rounding immediately eliminates unintended effects from
digits beyond the current precision. In the following example,
using unrounded inputs means that adding zero to a sum can
change the result:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">getcontext</span><span class="p">()</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.4445&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;1.0023&#39;</span><span class="p">)</span>
<span class="go">Decimal(&#39;4.45&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.4445&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;1.0023&#39;</span><span class="p">)</span>
<span class="go">Decimal(&#39;4.44&#39;)</span>
</pre></div>
</div>
<p>This method implements the to-number operation of the IBM
specification. If the argument is a string, no leading or
trailing whitespace is permitted.</p>
</blockquote>
<p>Etiny()</p>
<blockquote>
Returns a value equal to <tt class="docutils literal"><span class="pre">Emin</span> <span class="pre">-</span> <span class="pre">prec</span> <span class="pre">+</span> <span class="pre">1</span></tt> which is the
minimum exponent value for subnormal results.  When underflow
occurs, the exponent is set to <tt class="docutils literal"><span class="pre">Etiny</span></tt>.</blockquote>
<p>Etop()</p>
<blockquote>
Returns a value equal to <tt class="docutils literal"><span class="pre">Emax</span> <span class="pre">-</span> <span class="pre">prec</span> <span class="pre">+</span> <span class="pre">1</span></tt>.</blockquote>
<p>The usual approach to working with decimals is to create
<tt class="docutils literal"><span class="pre">Decimal</span></tt> instances and then apply arithmetic operations which
take place within the current context for the active thread.  An
alternative approach is to use context methods for calculating
within a specific context.  The methods are similar to those for
the <tt class="docutils literal"><span class="pre">Decimal</span></tt> class and are only briefly recounted here.</p>
<p>abs(x)</p>
<blockquote>
Returns the absolute value of <em>x</em>.</blockquote>
<p>add(x, y)</p>
<blockquote>
Return the sum of <em>x</em> and <em>y</em>.</blockquote>
<p>canonical(x)</p>
<blockquote>
Returns the same Decimal object <em>x</em>.</blockquote>
<p>compare(x, y)</p>
<blockquote>
Compares <em>x</em> and <em>y</em> numerically.</blockquote>
<p>compare_signal(x, y)</p>
<blockquote>
Compares the values of the two operands numerically.</blockquote>
<p>compare_total(x, y)</p>
<blockquote>
Compares two operands using their abstract representation.</blockquote>
<p>compare_total_mag(x, y)</p>
<blockquote>
Compares two operands using their abstract representation,
ignoring sign.</blockquote>
<p>copy_abs(x)</p>
<blockquote>
Returns a copy of <em>x</em> with the sign set to 0.</blockquote>
<p>copy_negate(x)</p>
<blockquote>
Returns a copy of <em>x</em> with the sign inverted.</blockquote>
<p>copy_sign(x, y)</p>
<blockquote>
Copies the sign from <em>y</em> to <em>x</em>.</blockquote>
<p>divide(x, y)</p>
<blockquote>
Return <em>x</em> divided by <em>y</em>.</blockquote>
<p>divide_int(x, y)</p>
<blockquote>
Return <em>x</em> divided by <em>y</em>, truncated to an integer.</blockquote>
<p>divmod(x, y)</p>
<blockquote>
Divides two numbers and returns the integer part of the result.</blockquote>
<p>exp(x)</p>
<blockquote>
Returns <em>e *</em> x*.</blockquote>
<p>fma(x, y, z)</p>
<blockquote>
Returns <em>x</em> multiplied by <em>y</em>, plus <em>z</em>.</blockquote>
<p>is_canonical(x)</p>
<blockquote>
Returns True if <em>x</em> is canonical; otherwise returns False.</blockquote>
<p>is_finite(x)</p>
<blockquote>
Returns True if <em>x</em> is finite; otherwise returns False.</blockquote>
<p>is_infinite(x)</p>
<blockquote>
Returns True if <em>x</em> is infinite; otherwise returns False.</blockquote>
<p>is_nan(x)</p>
<blockquote>
Returns True if <em>x</em> is a qNaN or sNaN; otherwise returns False.</blockquote>
<p>is_normal(x)</p>
<blockquote>
Returns True if <em>x</em> is a normal number; otherwise returns False.</blockquote>
<p>is_qnan(x)</p>
<blockquote>
Returns True if <em>x</em> is a quiet NaN; otherwise returns False.</blockquote>
<p>is_signed(x)</p>
<blockquote>
Returns True if <em>x</em> is negative; otherwise returns False.</blockquote>
<p>is_snan(x)</p>
<blockquote>
Returns True if <em>x</em> is a signaling NaN; otherwise returns False.</blockquote>
<p>is_subnormal(x)</p>
<blockquote>
Returns True if <em>x</em> is subnormal; otherwise returns False.</blockquote>
<p>is_zero(x)</p>
<blockquote>
Returns True if <em>x</em> is a zero; otherwise returns False.</blockquote>
<p>ln(x)</p>
<blockquote>
Returns the natural (base e) logarithm of <em>x</em>.</blockquote>
<p>log10(x)</p>
<blockquote>
Returns the base 10 logarithm of <em>x</em>.</blockquote>
<p>logb(x)</p>
<blockquote>
Returns the exponent of the magnitude of the operand&#8217;s MSD.</blockquote>
<p>logical_and(x, y)</p>
<blockquote>
Applies the logical operation <em>and</em> between each operand&#8217;s
digits.</blockquote>
<p>logical_invert(x)</p>
<blockquote>
Invert all the digits in <em>x</em>.</blockquote>
<p>logical_or(x, y)</p>
<blockquote>
Applies the logical operation <em>or</em> between each operand&#8217;s
digits.</blockquote>
<p>logical_xor(x, y)</p>
<blockquote>
Applies the logical operation <em>xor</em> between each operand&#8217;s
digits.</blockquote>
<p>max(x, y)</p>
<blockquote>
Compares two values numerically and returns the maximum.</blockquote>
<p>max_mag(x, y)</p>
<blockquote>
Compares the values numerically with their sign ignored.</blockquote>
<p>min(x, y)</p>
<blockquote>
Compares two values numerically and returns the minimum.</blockquote>
<p>min_mag(x, y)</p>
<blockquote>
Compares the values numerically with their sign ignored.</blockquote>
<p>minus(x)</p>
<blockquote>
Minus corresponds to the unary prefix minus operator in Python.</blockquote>
<p>multiply(x, y)</p>
<blockquote>
Return the product of <em>x</em> and <em>y</em>.</blockquote>
<p>next_minus(x)</p>
<blockquote>
Returns the largest representable number smaller than <em>x</em>.</blockquote>
<p>next_plus(x)</p>
<blockquote>
Returns the smallest representable number larger than <em>x</em>.</blockquote>
<p>next_toward(x, y)</p>
<blockquote>
Returns the number closest to <em>x</em>, in direction towards <em>y</em>.</blockquote>
<p>normalize(x)</p>
<blockquote>
Reduces <em>x</em> to its simplest form.</blockquote>
<p>number_class(x)</p>
<blockquote>
Returns an indication of the class of <em>x</em>.</blockquote>
<p>plus(x)</p>
<blockquote>
Plus corresponds to the unary prefix plus operator in Python.
This operation applies the context precision and rounding, so it
is <em>not</em> an identity operation.</blockquote>
<p>power(x, y[, modulo])</p>
<blockquote>
<p>Return <tt class="docutils literal"><span class="pre">x</span></tt> to the power of <tt class="docutils literal"><span class="pre">y</span></tt>, reduced modulo <tt class="docutils literal"><span class="pre">modulo</span></tt> if
given.</p>
<p>With two arguments, compute <tt class="docutils literal"><span class="pre">x**y</span></tt>.  If <tt class="docutils literal"><span class="pre">x</span></tt> is negative then
<tt class="docutils literal"><span class="pre">y</span></tt> must be integral.  The result will be inexact unless <tt class="docutils literal"><span class="pre">y</span></tt>
is integral and the result is finite and can be expressed
exactly in &#8216;precision&#8217; digits. The result should always be
correctly rounded, using the rounding mode of the current
thread&#8217;s context.</p>
<p>With three arguments, compute <tt class="docutils literal"><span class="pre">(x**y)</span> <span class="pre">%</span> <span class="pre">modulo</span></tt>.  For the
three argument form, the following restrictions on the arguments
hold:</p>
<blockquote>
<ul class="simple">
<li>all three arguments must be integral</li>
<li><tt class="docutils literal"><span class="pre">y</span></tt> must be nonnegative</li>
<li>at least one of <tt class="docutils literal"><span class="pre">x</span></tt> or <tt class="docutils literal"><span class="pre">y</span></tt> must be nonzero</li>
<li><tt class="docutils literal"><span class="pre">modulo</span></tt> must be nonzero and have at most &#8216;precision&#8217;
digits</li>
</ul>
</blockquote>
<p>The result of <tt class="docutils literal"><span class="pre">Context.power(x,</span> <span class="pre">y,</span> <span class="pre">modulo)</span></tt> is identical to
the result that would be obtained by computing <tt class="docutils literal"><span class="pre">(x**y)</span> <span class="pre">%</span>
<span class="pre">modulo</span></tt> with unbounded precision, but is computed more
efficiently.  It is always exact.</p>
<p>Changed in version 2.6: <tt class="docutils literal"><span class="pre">y</span></tt> may now be nonintegral in
<tt class="docutils literal"><span class="pre">x**y</span></tt>. Stricter requirements for the three-argument version.</p>
</blockquote>
<p>quantize(x, y)</p>
<blockquote>
Returns a value equal to <em>x</em> (rounded), having the exponent of
<em>y</em>.</blockquote>
<p>radix()</p>
<blockquote>
Just returns 10, as this is Decimal, :)</blockquote>
<p>remainder(x, y)</p>
<blockquote>
<p>Returns the remainder from integer division.</p>
<p>The sign of the result, if non-zero, is the same as that of the
original dividend.</p>
</blockquote>
<p>remainder_near(x, y)</p>
<blockquote>
Returns <tt class="docutils literal"><span class="pre">x</span> <span class="pre">-</span> <span class="pre">y</span> <span class="pre">*</span> <span class="pre">n</span></tt>, where <em>n</em> is the integer nearest the
exact value of <tt class="docutils literal"><span class="pre">x</span> <span class="pre">/</span> <span class="pre">y</span></tt> (if the result is 0 then its sign will
be the sign of <em>x</em>).</blockquote>
<p>rotate(x, y)</p>
<blockquote>
Returns a rotated copy of <em>x</em>, <em>y</em> times.</blockquote>
<p>same_quantum(x, y)</p>
<blockquote>
Returns True if the two operands have the same exponent.</blockquote>
<p>scaleb(x, y)</p>
<blockquote>
Returns the first operand after adding the second value its exp.</blockquote>
<p>shift(x, y)</p>
<blockquote>
Returns a shifted copy of <em>x</em>, <em>y</em> times.</blockquote>
<p>sqrt(x)</p>
<blockquote>
Square root of a non-negative number to context precision.</blockquote>
<p>subtract(x, y)</p>
<blockquote>
Return the difference between <em>x</em> and <em>y</em>.</blockquote>
<p>to_eng_string(x)</p>
<blockquote>
Converts a number to a string, using scientific notation.</blockquote>
<p>to_integral_exact(x)</p>
<blockquote>
Rounds to an integer.</blockquote>
<p>to_sci_string(x)</p>
<blockquote>
Converts a number to a string using scientific notation.</blockquote>
</blockquote>
</div>
<div class="section" id="signals">
<h2>9.3.4. Signals<a class="headerlink" href="#signals" title="Permalink to this headline">¶</a></h2>
<p>Signals represent conditions that arise during computation. Each
corresponds to one context flag and one context trap enabler.</p>
<p>The context flag is set whenever the condition is encountered. After
the computation, flags may be checked for informational purposes (for
instance, to determine whether a computation was exact). After
checking the flags, be sure to clear all flags before starting the
next computation.</p>
<p>If the context&#8217;s trap enabler is set for the signal, then the
condition causes a Python exception to be raised.  For example, if the
<tt class="docutils literal"><span class="pre">DivisionByZero</span></tt> trap is set, then a <tt class="docutils literal"><span class="pre">DivisionByZero</span></tt> exception is
raised upon encountering the condition.</p>
<p>class class decimal.Clamped</p>
<blockquote>
<p>Altered an exponent to fit representation constraints.</p>
<p>Typically, clamping occurs when an exponent falls outside the
context&#8217;s <tt class="docutils literal"><span class="pre">Emin</span></tt> and <tt class="docutils literal"><span class="pre">Emax</span></tt> limits.  If possible, the exponent
is reduced to fit by adding zeros to the coefficient.</p>
</blockquote>
<p>class class decimal.DecimalException</p>
<blockquote>
Base class for other signals and a subclass of <tt class="docutils literal"><span class="pre">ArithmeticError</span></tt>.</blockquote>
<p>class class decimal.DivisionByZero</p>
<blockquote>
<p>Signals the division of a non-infinite number by zero.</p>
<p>Can occur with division, modulo division, or when raising a number
to a negative power.  If this signal is not trapped, returns
<tt class="docutils literal"><span class="pre">Infinity</span></tt> or <tt class="docutils literal"><span class="pre">-Infinity</span></tt> with the sign determined by the
inputs to the calculation.</p>
</blockquote>
<p>class class decimal.Inexact</p>
<blockquote>
<p>Indicates that rounding occurred and the result is not exact.</p>
<p>Signals when non-zero digits were discarded during rounding. The
rounded result is returned.  The signal flag or trap is used to
detect when results are inexact.</p>
</blockquote>
<p>class class decimal.InvalidOperation</p>
<blockquote>
<p>An invalid operation was performed.</p>
<p>Indicates that an operation was requested that does not make sense.
If not trapped, returns <tt class="docutils literal"><span class="pre">NaN</span></tt>.  Possible causes include:</p>
<blockquote>
Infinity - Infinity
0 * Infinity
Infinity / Infinity
x % 0
Infinity % x
x._rescale( non-integer )
sqrt(-x) and x &gt; 0
0 ** 0
x ** (non-integer)
x ** Infinity</blockquote>
</blockquote>
<p>class class decimal.Overflow</p>
<blockquote>
<p>Numerical overflow.</p>
<p>Indicates the exponent is larger than <tt class="docutils literal"><span class="pre">Emax</span></tt> after rounding has
occurred.  If not trapped, the result depends on the rounding mode,
either pulling inward to the largest representable finite number or
rounding outward to <tt class="docutils literal"><span class="pre">Infinity</span></tt>.  In either case, <tt class="docutils literal"><span class="pre">Inexact</span></tt> and
<tt class="docutils literal"><span class="pre">Rounded</span></tt> are also signaled.</p>
</blockquote>
<p>class class decimal.Rounded</p>
<blockquote>
<p>Rounding occurred though possibly no information was lost.</p>
<p>Signaled whenever rounding discards digits; even if those digits
are zero (such as rounding <tt class="docutils literal"><span class="pre">5.00</span></tt> to <tt class="docutils literal"><span class="pre">5.0</span></tt>).  If not trapped,
returns the result unchanged.  This signal is used to detect loss
of significant digits.</p>
</blockquote>
<p>class class decimal.Subnormal</p>
<blockquote>
<p>Exponent was lower than <tt class="docutils literal"><span class="pre">Emin</span></tt> prior to rounding.</p>
<p>Occurs when an operation result is subnormal (the exponent is too
small). If not trapped, returns the result unchanged.</p>
</blockquote>
<p>class class decimal.Underflow</p>
<blockquote>
<p>Numerical underflow with result rounded to zero.</p>
<p>Occurs when a subnormal result is pushed to zero by rounding.
<tt class="docutils literal"><span class="pre">Inexact</span></tt> and <tt class="docutils literal"><span class="pre">Subnormal</span></tt> are also signaled.</p>
</blockquote>
<p>The following table summarizes the hierarchy of signals:</p>
<blockquote>
<dl class="docutils">
<dt>exceptions.ArithmeticError(exceptions.StandardError)</dt>
<dd><dl class="first last docutils">
<dt>DecimalException</dt>
<dd><p class="first">Clamped
DivisionByZero(DecimalException, exceptions.ZeroDivisionError)
Inexact</p>
<blockquote>
Overflow(Inexact, Rounded)
Underflow(Inexact, Rounded, Subnormal)</blockquote>
<p class="last">InvalidOperation
Rounded
Subnormal</p>
</dd>
</dl>
</dd>
</dl>
</blockquote>
</div>
<div class="section" id="floating-point-notes">
<h2>9.3.5. Floating Point Notes<a class="headerlink" href="#floating-point-notes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="mitigating-round-off-error-with-increased-precision">
<h3>9.3.5.1. Mitigating round-off error with increased precision<a class="headerlink" href="#mitigating-round-off-error-with-increased-precision" title="Permalink to this headline">¶</a></h3>
<p>The use of decimal floating point eliminates decimal representation
error (making it possible to represent <tt class="docutils literal"><span class="pre">0.1</span></tt> exactly); however, some
operations can still incur round-off error when non-zero digits exceed
the fixed precision.</p>
<p>The effects of round-off error can be amplified by the addition or
subtraction of nearly offsetting quantities resulting in loss of
significance.  Knuth provides two instructive examples where rounded
floating point arithmetic with insufficient precision causes the
breakdown of the associative and distributive properties of addition:</p>
<blockquote>
<p># Examples from Seminumerical Algorithms, Section 4.2.2.
&gt;&gt;&gt; from decimal import Decimal, getcontext
&gt;&gt;&gt; getcontext().prec = 8</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">11111113</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="o">-</span><span class="mi">11111111</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;7.51111111&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">u</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="n">w</span>
<span class="go">Decimal(&#39;9.5111111&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">+</span> <span class="p">(</span><span class="n">v</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span>
<span class="go">Decimal(&#39;10&#39;)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">20000</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;6.0000003&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">w</span><span class="p">)</span>
<span class="go">Decimal(&#39;0.01&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">*</span> <span class="p">(</span><span class="n">v</span><span class="o">+</span><span class="n">w</span><span class="p">)</span>
<span class="go">Decimal(&#39;0.0060000&#39;)</span>
</pre></div>
</div>
</blockquote>
<p>The <tt class="docutils literal"><span class="pre">decimal</span></tt> module makes it possible to restore the identities by
expanding the precision sufficiently to avoid loss of significance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">getcontext</span><span class="p">()</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="mi">20</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">11111113</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="o">-</span><span class="mi">11111111</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;7.51111111&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">u</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="n">w</span>
<span class="go">Decimal(&#39;9.51111111&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">+</span> <span class="p">(</span><span class="n">v</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span>
<span class="go">Decimal(&#39;9.51111111&#39;)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">20000</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;6.0000003&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">w</span><span class="p">)</span>
<span class="go">Decimal(&#39;0.0060000&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">*</span> <span class="p">(</span><span class="n">v</span><span class="o">+</span><span class="n">w</span><span class="p">)</span>
<span class="go">Decimal(&#39;0.0060000&#39;)</span>
</pre></div>
</div>
</div>
<div class="section" id="special-values">
<h3>9.3.5.2. Special values<a class="headerlink" href="#special-values" title="Permalink to this headline">¶</a></h3>
<p>The number system for the <tt class="docutils literal"><span class="pre">decimal</span></tt> module provides special values
including <tt class="docutils literal"><span class="pre">NaN</span></tt>, <tt class="docutils literal"><span class="pre">sNaN</span></tt>, <tt class="docutils literal"><span class="pre">-Infinity</span></tt>, <tt class="docutils literal"><span class="pre">Infinity</span></tt>, and two
zeros, <tt class="docutils literal"><span class="pre">+0</span></tt> and <tt class="docutils literal"><span class="pre">-0</span></tt>.</p>
<p>Infinities can be constructed directly with:  <tt class="docutils literal"><span class="pre">Decimal('Infinity')</span></tt>.
Also, they can arise from dividing by zero when the <tt class="docutils literal"><span class="pre">DivisionByZero</span></tt>
signal is not trapped.  Likewise, when the <tt class="docutils literal"><span class="pre">Overflow</span></tt> signal is not
trapped, infinity can result from rounding beyond the limits of the
largest representable number.</p>
<p>The infinities are signed (affine) and can be used in arithmetic
operations where they get treated as very large, indeterminate
numbers.  For instance, adding a constant to infinity gives another
infinite result.</p>
<p>Some operations are indeterminate and return <tt class="docutils literal"><span class="pre">NaN</span></tt>, or if the
<tt class="docutils literal"><span class="pre">InvalidOperation</span></tt> signal is trapped, raise an exception.  For
example, <tt class="docutils literal"><span class="pre">0/0</span></tt> returns <tt class="docutils literal"><span class="pre">NaN</span></tt> which means &#8220;not a number&#8221;.  This
variety of <tt class="docutils literal"><span class="pre">NaN</span></tt> is quiet and, once created, will flow through other
computations always resulting in another <tt class="docutils literal"><span class="pre">NaN</span></tt>.  This behavior can
be useful for a series of computations that occasionally have missing
inputs &#8212; it allows the calculation to proceed while flagging
specific results as invalid.</p>
<p>A variant is <tt class="docutils literal"><span class="pre">sNaN</span></tt> which signals rather than remaining quiet after
every operation.  This is a useful return value when an invalid result
needs to interrupt a calculation for special handling.</p>
<p>The behavior of Python&#8217;s comparison operators can be a little
surprising where a <tt class="docutils literal"><span class="pre">NaN</span></tt> is involved.  A test for equality where one
of the operands is a quiet or signaling <tt class="docutils literal"><span class="pre">NaN</span></tt> always returns
<tt class="xref docutils literal"><span class="pre">False</span></tt> (even when doing <tt class="docutils literal"><span class="pre">Decimal('NaN')==Decimal('NaN')</span></tt>), while
a test for inequality always returns <tt class="xref docutils literal"><span class="pre">True</span></tt>.  An attempt to compare
two Decimals using any of the <tt class="docutils literal"><span class="pre">&lt;</span></tt>, <tt class="docutils literal"><span class="pre">&lt;=</span></tt>, <tt class="docutils literal"><span class="pre">&gt;</span></tt> or <tt class="docutils literal"><span class="pre">&gt;=</span></tt> operators
will raise the <tt class="docutils literal"><span class="pre">InvalidOperation</span></tt> signal if either operand is a
<tt class="docutils literal"><span class="pre">NaN</span></tt>, and return <tt class="xref docutils literal"><span class="pre">False</span></tt> if this signal is not trapped.  Note
that the General Decimal Arithmetic specification does not specify the
behavior of direct comparisons; these rules for comparisons involving
a <tt class="docutils literal"><span class="pre">NaN</span></tt> were taken from the IEEE 854 standard (see Table 3 in
section 5.7).  To ensure strict standards-compliance, use the
<tt class="docutils literal"><span class="pre">compare()</span></tt> and <tt class="docutils literal"><span class="pre">compare-signal()</span></tt> methods instead.</p>
<p>The signed zeros can result from calculations that underflow. They
keep the sign that would have resulted if the calculation had been
carried out to greater precision.  Since their magnitude is zero, both
positive and negative zeros are treated as equal and their sign is
informational.</p>
<p>In addition to the two signed zeros which are distinct yet equal,
there are various representations of zero with differing precisions
yet equivalent in value.  This takes a bit of getting used to.  For an
eye accustomed to normalized floating point representations, it is not
immediately obvious that the following calculation returns a value
equal to zero:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="mi">1</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;Infinity&#39;</span><span class="p">)</span>
<span class="go">Decimal(&#39;0E-1000000026&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="working-with-threads">
<h2>9.3.6. Working with threads<a class="headerlink" href="#working-with-threads" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">getcontext()</span></tt> function accesses a different <tt class="docutils literal"><span class="pre">Context</span></tt> object
for each thread.  Having separate thread contexts means that threads
may make changes (such as <tt class="docutils literal"><span class="pre">getcontext.prec=10</span></tt>) without interfering
with other threads.</p>
<p>Likewise, the <tt class="docutils literal"><span class="pre">setcontext()</span></tt> function automatically assigns its
target to the current thread.</p>
<p>If <tt class="docutils literal"><span class="pre">setcontext()</span></tt> has not been called before <tt class="docutils literal"><span class="pre">getcontext()</span></tt>, then
<tt class="docutils literal"><span class="pre">getcontext()</span></tt> will automatically create a new context for use in
the current thread.</p>
<p>The new context is copied from a prototype context called
<em>DefaultContext</em>. To control the defaults so that each thread will use
the same values throughout the application, directly modify the
<em>DefaultContext</em> object. This should be done <em>before</em> any threads are
started so that there won&#8217;t be a race condition between threads
calling <tt class="docutils literal"><span class="pre">getcontext()</span></tt>. For example:</p>
<blockquote>
<p># Set applicationwide defaults for all threads about to be launched
DefaultContext.prec = 12
DefaultContext.rounding = ROUND_DOWN
DefaultContext.traps = ExtendedContext.traps.copy()
DefaultContext.traps[InvalidOperation] = 1
setcontext(DefaultContext)</p>
<p># Afterwards, the threads can be started
t1.start()
t2.start()
t3.start()</p>
<blockquote>
. . .</blockquote>
</blockquote>
</div>
<div class="section" id="recipes">
<h2>9.3.7. Recipes<a class="headerlink" href="#recipes" title="Permalink to this headline">¶</a></h2>
<p>Here are a few recipes that serve as utility functions and that
demonstrate ways to work with the <tt class="docutils literal"><span class="pre">Decimal</span></tt> class:</p>
<blockquote>
<dl class="docutils">
<dt>def moneyfmt(value, places=2, curr=&#8217;&#8216;, sep=&#8217;,&#8217;, dp=&#8217;.&#8217;,</dt>
<dd><blockquote class="first">
pos=&#8217;&#8216;, neg=&#8217;-&#8216;, trailneg=&#8217;&#8216;):</blockquote>
<p>&#8220;&#8221;&#8220;Convert Decimal to a money formatted string.</p>
<p>places:  required number of places after the decimal point
curr:    optional currency symbol before the sign (may be blank)
sep:     optional grouping separator (comma, period, space, or blank)
dp:      decimal point indicator (comma or period)</p>
<blockquote>
only specify as blank when places is zero</blockquote>
<p>pos:     optional sign for positive numbers: &#8216;+&#8217;, space or blank
neg:     optional sign for negative numbers: &#8216;-&#8216;, &#8216;(&#8216;, space or blank
trailneg:optional trailing minus indicator:  &#8216;-&#8216;, &#8216;)&#8217;, space or blank</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;-1234567.8901&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">moneyfmt</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">curr</span><span class="o">=</span><span class="s">&#39;$&#39;</span><span class="p">)</span>
<span class="go">&#39;-$1,234,567.89&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">moneyfmt</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">dp</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">neg</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">trailneg</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
<span class="go">&#39;1.234.568-&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">moneyfmt</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">curr</span><span class="o">=</span><span class="s">&#39;$&#39;</span><span class="p">,</span> <span class="n">neg</span><span class="o">=</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="n">trailneg</span><span class="o">=</span><span class="s">&#39;)&#39;</span><span class="p">)</span>
<span class="go">&#39;($1,234,567.89)&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">moneyfmt</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="mi">123456789</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">)</span>
<span class="go">&#39;123 456 789.00&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">moneyfmt</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;-0.02&#39;</span><span class="p">),</span> <span class="n">neg</span><span class="o">=</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="n">trailneg</span><span class="o">=</span><span class="s">&#39;&gt;&#39;</span><span class="p">)</span>
<span class="go">&#39;&lt;0.02&gt;&#39;</span>
</pre></div>
</div>
<p>&#8220;&#8221;&#8221;
q = Decimal(10) ** -places      # 2 places &#8211;&gt; &#8216;0.01&#8217;
sign, digits, exp = value.quantize(q).as_tuple()
result = []
digits = map(str, digits)
build, next = result.append, digits.pop
if sign:</p>
<blockquote>
build(trailneg)</blockquote>
<dl class="docutils">
<dt>for i in range(places):</dt>
<dd>build(next() if digits else &#8216;0&#8217;)</dd>
</dl>
<p>build(dp)
if not digits:</p>
<blockquote>
build(&#8216;0&#8217;)</blockquote>
<p>i = 0
while digits:</p>
<blockquote>
<p>build(next())
i += 1
if i == 3 and digits:</p>
<blockquote>
i = 0
build(sep)</blockquote>
</blockquote>
<p class="last">build(curr)
build(neg if sign else pos)
return &#8216;&#8217;.join(reversed(result))</p>
</dd>
<dt>def pi():</dt>
<dd><p class="first">&#8220;&#8221;&#8220;Compute Pi to the current precision.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">pi</span><span class="p">()</span>
<span class="go">3.141592653589793238462643383</span>
</pre></div>
</div>
<p>&#8220;&#8221;&#8221;
getcontext().prec += 2  # extra digits for intermediate steps
three = Decimal(3)      # substitute &#8220;three=3.0&#8221; for regular floats
lasts, t, s, n, na, d, da = 0, three, 3, 1, 0, 0, 24
while s != lasts:</p>
<blockquote>
lasts = s
n, na = n+na, na+8
d, da = d+da, da+32
t = (t * n) / d
s += t</blockquote>
<p class="last">getcontext().prec -= 2
return +s               # unary plus applies the new precision</p>
</dd>
<dt>def exp(x):</dt>
<dd><p class="first">&#8220;&#8221;&#8220;Return e raised to the power of x.  Result type matches input type.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">exp</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="go">2.718281828459045235360287471</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">exp</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="go">7.389056098930650227230427461</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">exp</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
<span class="go">7.38905609893</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="mi">0</span><span class="n">j</span><span class="p">)</span>
<span class="go">(7.38905609893+0j)</span>
</pre></div>
</div>
<p>&#8220;&#8221;&#8221;
getcontext().prec += 2
i, lasts, s, fact, num = 0, 0, 1, 1, 1
while s != lasts:</p>
<blockquote>
lasts = s
i += 1
fact <a href="#id1"><span class="problematic" id="id2">*</span></a>= i
num <a href="#id3"><span class="problematic" id="id4">*</span></a>= x
s += num / fact</blockquote>
<p class="last">getcontext().prec -= 2
return +s</p>
</dd>
<dt>def cos(x):</dt>
<dd><p class="first">&#8220;&#8221;&#8220;Return the cosine of x as measured in radians.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">cos</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;0.5&#39;</span><span class="p">))</span>
<span class="go">0.8775825618903727161162815826</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">cos</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="go">0.87758256189</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">cos</span><span class="p">(</span><span class="mf">0.5</span><span class="o">+</span><span class="mi">0</span><span class="n">j</span><span class="p">)</span>
<span class="go">(0.87758256189+0j)</span>
</pre></div>
</div>
<p>&#8220;&#8221;&#8221;
getcontext().prec += 2
i, lasts, s, fact, num, sign = 0, 0, 1, 1, 1, 1
while s != lasts:</p>
<blockquote>
lasts = s
i += 2
fact <a href="#id5"><span class="problematic" id="id6">*</span></a>= i * (i-1)
num <a href="#id7"><span class="problematic" id="id8">*</span></a>= x * x
sign <a href="#id9"><span class="problematic" id="id10">*</span></a>= -1
s += num / fact * sign</blockquote>
<p class="last">getcontext().prec -= 2
return +s</p>
</dd>
<dt>def sin(x):</dt>
<dd><p class="first">&#8220;&#8221;&#8220;Return the sine of x as measured in radians.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">sin</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;0.5&#39;</span><span class="p">))</span>
<span class="go">0.4794255386042030002732879352</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">sin</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="go">0.479425538604</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">sin</span><span class="p">(</span><span class="mf">0.5</span><span class="o">+</span><span class="mi">0</span><span class="n">j</span><span class="p">)</span>
<span class="go">(0.479425538604+0j)</span>
</pre></div>
</div>
<p>&#8220;&#8221;&#8221;
getcontext().prec += 2
i, lasts, s, fact, num, sign = 1, 0, x, 1, x, 1
while s != lasts:</p>
<blockquote>
lasts = s
i += 2
fact <a href="#id11"><span class="problematic" id="id12">*</span></a>= i * (i-1)
num <a href="#id13"><span class="problematic" id="id14">*</span></a>= x * x
sign <a href="#id15"><span class="problematic" id="id16">*</span></a>= -1
s += num / fact * sign</blockquote>
<p class="last">getcontext().prec -= 2
return +s</p>
</dd>
</dl>
</blockquote>
</div>
<div class="section" id="decimal-faq">
<h2>9.3.8. Decimal FAQ<a class="headerlink" href="#decimal-faq" title="Permalink to this headline">¶</a></h2>
<p>Q. It is cumbersome to type <tt class="docutils literal"><span class="pre">decimal.Decimal('1234.5')</span></tt>.  Is there a
way to minimize typing when using the interactive interpreter?</p>
<ol class="upperalpha simple">
<li>Some users abbreviate the constructor to just a single letter:</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">D</span> <span class="o">=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">D</span><span class="p">(</span><span class="s">&#39;1.23&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">D</span><span class="p">(</span><span class="s">&#39;3.45&#39;</span><span class="p">)</span>
<span class="go">Decimal(&#39;4.68&#39;)</span>
</pre></div>
</div>
<p>Q. In a fixed-point application with two decimal places, some inputs
have many places and need to be rounded.  Others are not supposed to
have excess digits and need to be validated.  What methods should be
used?</p>
<p>A. The <tt class="docutils literal"><span class="pre">quantize()</span></tt> method rounds to a fixed number of decimal
places. If the <tt class="docutils literal"><span class="pre">Inexact</span></tt> trap is set, it is also useful for
validation:</p>
<blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">TWOPLACES</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mi">2</span>       <span class="c"># same as Decimal(&#39;0.01&#39;)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># Round to two places</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.214&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">TWOPLACES</span><span class="p">)</span>
<span class="go">Decimal(&#39;3.21&#39;)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># Validate that a number does not exceed two places</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.21&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">TWOPLACES</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">Context</span><span class="p">(</span><span class="n">traps</span><span class="o">=</span><span class="p">[</span><span class="n">Inexact</span><span class="p">]))</span>
<span class="go">Decimal(&#39;3.21&#39;)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.214&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">TWOPLACES</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">Context</span><span class="p">(</span><span class="n">traps</span><span class="o">=</span><span class="p">[</span><span class="n">Inexact</span><span class="p">]))</span>
<span class="gt">Traceback (most recent call last):</span>
   <span class="c">...</span>
<span class="nc">Inexact</span>: <span class="n-Identifier">None</span>
</pre></div>
</div>
</blockquote>
<p>Q. Once I have valid two place inputs, how do I maintain that
invariant throughout an application?</p>
<p>A. Some operations like addition, subtraction, and multiplication by
an integer will automatically preserve fixed point.  Others
operations, like division and non-integer multiplication, will change
the number of decimal places and need to be followed-up with a
<tt class="docutils literal"><span class="pre">quantize()</span></tt> step:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;102.72&#39;</span><span class="p">)</span>           <span class="c"># Initial fixed-point values</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.17&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span>                           <span class="c"># Addition preserves fixed-point</span>
<span class="go">Decimal(&#39;105.89&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
<span class="go">Decimal(&#39;99.55&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">*</span> <span class="mi">42</span>                          <span class="c"># So does integer multiplication</span>
<span class="go">Decimal(&#39;4314.24&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">TWOPLACES</span><span class="p">)</span>     <span class="c"># Must quantize non-integer multiplication</span>
<span class="go">Decimal(&#39;325.62&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">b</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">TWOPLACES</span><span class="p">)</span>     <span class="c"># And quantize division</span>
<span class="go">Decimal(&#39;0.03&#39;)</span>
</pre></div>
</div>
<p>In developing fixed-point applications, it is convenient to define
functions to handle the <tt class="docutils literal"><span class="pre">quantize()</span></tt> step:</p>
<blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="n">TWOPLACES</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="n">TWOPLACES</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>                       <span class="c"># Automatically preserve fixed-point</span>
<span class="go">Decimal(&#39;325.62&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">div</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="go">Decimal(&#39;0.03&#39;)</span>
</pre></div>
</div>
</blockquote>
<p>Q. There are many ways to express the same value.  The numbers
<tt class="docutils literal"><span class="pre">200</span></tt>, <tt class="docutils literal"><span class="pre">200.000</span></tt>, <tt class="docutils literal"><span class="pre">2E2</span></tt>, and <tt class="docutils literal"><span class="pre">02E+4</span></tt> all have the same value
at various precisions. Is there a way to transform them to a single
recognizable canonical value?</p>
<p>A. The <tt class="docutils literal"><span class="pre">normalize()</span></tt> method maps all equivalent values to a single
representative:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">values</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">Decimal</span><span class="p">,</span> <span class="s">&#39;200 200.000 2E2 .02E+4&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
<span class="go">[Decimal(&#39;2E+2&#39;), Decimal(&#39;2E+2&#39;), Decimal(&#39;2E+2&#39;), Decimal(&#39;2E+2&#39;)]</span>
</pre></div>
</div>
<p>Q. Some decimal values always print with exponential notation.  Is
there a way to get a non-exponential representation?</p>
<p>A. For some values, exponential notation is the only way to express
the number of significant places in the coefficient.  For example,
expressing <tt class="docutils literal"><span class="pre">5.0E+3</span></tt> as <tt class="docutils literal"><span class="pre">5000</span></tt> keeps the value constant but cannot
show the original&#8217;s two-place significance.</p>
<p>If an application does not care about tracking significance, it is
easy to remove the exponent and trailing zeroes, losing significance,
but keeping the value unchanged:</p>
<blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">remove_exponent</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="n">d</span><span class="o">.</span><span class="n">to_integral</span><span class="p">()</span> <span class="k">else</span> <span class="n">d</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">remove_exponent</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;5E+3&#39;</span><span class="p">))</span>
<span class="go">Decimal(&#39;5000&#39;)</span>
</pre></div>
</div>
</blockquote>
<ol class="upperalpha simple" start="17">
<li>Is there a way to convert a regular float to a <tt class="docutils literal"><span class="pre">Decimal</span></tt>?</li>
</ol>
<p>A. Yes, all binary floating point numbers can be exactly expressed as
a Decimal.  An exact conversion may take more precision than intuition
would suggest, so we trap <tt class="docutils literal"><span class="pre">Inexact</span></tt> to signal a need for more
precision:</p>
<blockquote>
<dl class="docutils">
<dt>def float_to_decimal(f):</dt>
<dd><p class="first">&#8220;Convert a floating point number to a Decimal with no loss of information&#8221;
n, d = f.as_integer_ratio()
numerator, denominator = Decimal(n), Decimal(d)
ctx = Context(prec=60)
result = ctx.divide(numerator, denominator)
while ctx.flags[Inexact]:</p>
<blockquote>
ctx.flags[Inexact] = False
ctx.prec <a href="#id17"><span class="problematic" id="id18">*</span></a>= 2
result = ctx.divide(numerator, denominator)</blockquote>
<p class="last">return result</p>
</dd>
</dl>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">float_to_decimal</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="go">Decimal(&#39;3.141592653589793115997963468544185161590576171875&#39;)</span>
</pre></div>
</div>
</blockquote>
<p>Q. Why isn&#8217;t the <tt class="docutils literal"><span class="pre">float_to_decimal()</span></tt> routine included in the
module?</p>
<p>A. There is some question about whether it is advisable to mix binary
and decimal floating point.  Also, its use requires some care to avoid
the representation issues associated with binary floating point:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">float_to_decimal</span><span class="p">(</span><span class="mf">1.1</span><span class="p">)</span>
<span class="go">Decimal(&#39;1.100000000000000088817841970012523233890533447265625&#39;)</span>
</pre></div>
</div>
<p>Q. Within a complex calculation, how can I make sure that I haven&#8217;t
gotten a spurious result because of insufficient precision or rounding
anomalies.</p>
<p>A. The decimal module makes it easy to test results.  A best practice
is to re-run calculations using greater precision and with various
rounding modes. Widely differing results indicate insufficient
precision, rounding mode issues, ill-conditioned inputs, or a
numerically unstable algorithm.</p>
<p>Q. I noticed that context precision is applied to the results of
operations but not to the inputs.  Is there anything to watch out for
when mixing values of different precisions?</p>
<p>A. Yes.  The principle is that all values are considered to be exact
and so is the arithmetic on those values.  Only the results are
rounded.  The advantage for inputs is that &#8220;what you type is what you
get&#8221;.  A disadvantage is that the results can look odd if you forget
that the inputs haven&#8217;t been rounded:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">getcontext</span><span class="p">()</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.104&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;2.104&#39;</span><span class="p">)</span>
<span class="go">Decimal(&#39;5.21&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.104&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;0.000&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;2.104&#39;</span><span class="p">)</span>
<span class="go">Decimal(&#39;5.20&#39;)</span>
</pre></div>
</div>
<p>The solution is either to increase precision or to force rounding of
inputs using the unary plus operation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">getcontext</span><span class="p">()</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">+</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;1.23456789&#39;</span><span class="p">)</span>      <span class="c"># unary plus triggers rounding</span>
<span class="go">Decimal(&#39;1.23&#39;)</span>
</pre></div>
</div>
<p>Alternatively, inputs can be rounded upon creation using the
<tt class="docutils literal"><span class="pre">Context.create_decimal()</span></tt> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Context</span><span class="p">(</span><span class="n">prec</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">rounding</span><span class="o">=</span><span class="n">ROUND_DOWN</span><span class="p">)</span><span class="o">.</span><span class="n">create_decimal</span><span class="p">(</span><span class="s">&#39;1.2345678&#39;</span><span class="p">)</span>
<span class="go">Decimal(&#39;1.2345&#39;)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>


      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="random.html" title="9.4. random — Generate pseudo-random numbers"
             >next</a> |</li>
        <li class="right" >
          <a href="cmath.html" title="9.2. cmath — Mathematical functions for complex numbers"
             >previous</a> |</li>
        <li><a href="../index.html">Jython v2.5.2 documentation</a> &raquo;</li>
          <li><a href="indexprogress.html" >The Python Standard Library and What Comes with Jython</a> &raquo;</li>
          <li><a href="numeric.html" >9. Numeric and Mathematical Modules</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; <a href="../copyright.html">Copyright</a> 2011, Jython Project.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.4.
    </div>
  </body>
</html>